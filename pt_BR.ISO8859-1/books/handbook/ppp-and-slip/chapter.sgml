<!--
     The FreeBSD Documentation Project

     $FreeBSD: pt_BR.ISO8859-1/books/handbook/ppp-and-slip/chapter.sgml,v 1.5 2003/12/11 19:15:46 tirloni Exp $
-->

<chapter id="ppp-and-slip">
  <chapterinfo>
    <authorgroup>
      <author>
	<firstname>Jim</firstname>
	<surname>Mock</surname>
	<contrib>Reestruturado, reorganizado e
	atualizado por </contrib>
	<!-- 1 Mar 2000 -->
      </author>
    </authorgroup>
  </chapterinfo>

  <title>PPP and SLIP</title>

  <sect1 id="ppp-and-slip-synopsis">
    <title>Sinópse</title>
    <indexterm id="ppp-ppp">
      <primary>PPP</primary>
    </indexterm>
    <indexterm id="ppp-slip">
      <primary>SLIP</primary>
    </indexterm>

    <para>O FreeBSD possui várias formas de ligar um computador a
      outro.
      Para estabelecer uma rede ou conexão com a Internet através de um
      modem discado, ou para permitir que outros façam isso através de você,
      é necessário o uso de PPP ou SLIP.  Esse capítulo descreve como configurar
      esses serviços de comunicação em detalhes.</para>

    <para>Após ler este capítulo, você saberá:</para>

    <itemizedlist>
      <listitem>
	<para>Como ajustar PPP em modo usuário.</para>
      </listitem>
      <listitem>
	<para>Como ajustar PPP em modo kernel.</para>
      </listitem>
      <listitem>
	<para>Como ajustar <acronym>PPPoE</acronym> (PPP over
	  Ethernet).</para>
      </listitem>
      <listitem>
	<para>Como ajustar <acronym>PPPoA</acronym> (PPP over
	  ATM).</para>
	</listitem>
      <listitem>
	<para>Como configurar e ajustar um cliente SLIP e um servidor.</para>
      </listitem>
    </itemizedlist>

    <indexterm id="ppp-ppp-user">
      <primary>PPP</primary>
      <secondary>user PPP</secondary>
    </indexterm>
    <indexterm id="ppp-ppp-kernel">
      <primary>PPP</primary>
      <secondary>kernel PPP</secondary>
    </indexterm>
    <indexterm id="ppp-ppp-ethernet">
      <primary>PPP</primary>
      <secondary>over Ethernet</secondary>
    </indexterm>

    <para>Antes de ler este capítulo você deve:</para>

    <itemizedlist>
      <listitem>
	<para>Estar familiarizado com a terminologia básica utilizada em redes.</para>
      </listitem>
      <listitem>
	<para>Ter noções básicas e entender o propósito de uma conexão discada,
	  do protocolo PPP e/ou SLIP.
      </listitem>
    </itemizedlist>

    <para>Você deve estar curioso para saber qual a diferença entre PPP em modo
      usuário e em modo kernel.  A resposta é simples: em modo usuário o PPP processa
      o tráfego entrante e sainte em um processo normal em vez de fazer isso
      internamente no kernel.  Isso é caro em termos de cópias de dados geradas
      entre o kernel e o processo, mas permite uma implementação PPP muito mais
      rica em funcionalidades.  PPP em modo usuário usa o dispositivo
      <devicename>tun</devicename> para se comunicar com o mundo externo onde
      o PPP em modo kernel utiliza o dispositivo <devicename>ppp</devicename>.</para>

    <note>
      <para>Durante todo este capítulo, PPP em modo usuário será simplesmente
	citado como <application>ppp</application> a não ser que uma distinção
	seja necessária entre este e qualquer outro software PPP como o
	<application>pppd</application>.  A menos que indicado de outra maneira,
	todos os comandos explicados neste capítulo devem ser executados como
	<username>root</username>.</para>
    </note>
  </sect1>

  <sect1 id="userppp">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Atualizado e melhorado por </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Brian</firstname>
	  <surname>Somers</surname>
	  <contrib>Originalmente contribuído por </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Nik</firstname>
	  <surname>Clayton</surname>
	  <contrib>Com adições de </contrib>
	</author>
	<author>
	  <firstname>Dirk</firstname>
	  <surname>Fr&ouml;mberg</surname>
	</author>
	<author>
	  <firstname>Peter</firstname>
	  <surname>Childs</surname>
	</author>
      </authorgroup>
    </sect1info>

    <title>Utilizando PPP em modo usuário</title>

    <sect2>
      <title>PPP em modo usuário</title>

      <sect3>
	<title>Suposições</title>

	<para>Este documento assume que você tem o seguinte:</para>

	<itemizedlist>
	  <indexterm id="ppp-isp">
	    <primary>ISP</primary>
	  </indexterm>
	  <indexterm id="ppp-ppp2">
	    <primary>PPP</primary>
	  </indexterm>
	  <listitem>
	    <para>Uma conta com um provedor de acesso a Internet (ISP) através do qual você se conecta
	      utilizando PPP.</para>
	  </listitem>

	  <listitem>
	    <para>Um modem ou outro dispositivo conectado ao seu sistema e configura corretamente
	      que permite a você se conectar ao seu provedor.</para>
	  </listitem>

	  <listitem>
	    <para>O número de discagem do seu provedor.</para>
	  </listitem>

	  <indexterm id="ppp-pap">
	    <primary>PAP</primary>
	  </indexterm>
	  <indexterm id="ppp-chap">
	    <primary>CHAP</primary>
	  </indexterm>
	  <indexterm id="ppp-unix">
	    <primary>UNIX</primary>
	  </indexterm>
	  <indexterm id="ppp-login">
	    <primary>login name</primary>
	  </indexterm>
	  <indexterm id="ppp-password">
	    <primary>password</primary>
	  </indexterm>
	  <listitem>
	    <para>Seu usuário e senha.  (um par &unix; de usuário e senha ou um par PAP ou CHAP).</para>
	  </listitem>

	  <indexterm id="ppp-nameserver">
	    <primary>nameserver</primary>
	  </indexterm>
	  <listitem>
	    <para>O endereço IP de um ou mais servidores de nomes.  Normalmente você
	      receberá dois endereços IP do seu provedor para esta finalidade.  Se
	      você não recebeu ao menos um endereço pode utilizar o comando
	      <command>enable dns</command> no arquivo <filename>ppp.conf</filename> e
	      o <application>ppp</application> irá ajustar os servidores de nome
	      para você.  Essa funcionalidade depende do suporte a negociação de DNS
	      que a implementação PPP do seu provedor oferece.</para>
	  </listitem>
	</itemizedlist>

	<para>As seguintes informações podem ser providas por seu provedor mas
	  não são totalmente necessárias:</para>

	<itemizedlist>
	  <listitem>
	    <para>
	    <para>O endereço IP do <foreignphrase>gateway</foreignphrase> do seu
	      provedor.  O <foreignphrase>gateway</foreignphrase> é uma máquina a
	      qual você irá se conectar e que irá ser ajustada como sua
	      <emphasis>rota padrão</emphasis>.  Se você não tem essa informação
	      nos podemos criar um endereço qualquer e o servidor PPP do seu
	      provedor irá nos informar qual é o valor correto quando nós nos
	      conectarmos.

	    <para>Este endereço IP é referido como
	      <literal>HISADDR</literal> pelo
	      <application>ppp</application>.</para>
	  </listitem>

	  <listitem>
	    <para>A máscara de rede que você deve usar.  Se seu provedor não lhe
	      informou um você pode seguramente usar <hostid role="netmask">
	      255.255.255.255</hostid>.</para>
	  </listitem>

	  <indexterm id="ppp-static-ip">
	    <primary>static IP address</primary>
	  </indexterm>
	  <listitem>
	     <para>Se seu provedor lhe oferece um endereço IP estático e
	      um hostname, você pode digitá-los.
	      Caso contrário, nós simplesmente deixamos que o servidor remoto
	      defina qualquer endereço IP que ele achar conveniente.</para>
	  </listitem>
	</itemizedlist>

	<para>Se você não tem nenhuma dessas informações, entre em contato com seu
	  provedor de acesso.</para>

	<note>
	  <para>Durante toda essa seção muitos dos exemplos que se utilizam do
	    conteúdo de arquivos de configuração são numerados por linha.  Esses
	    números servem para ajudar na apresentação e discussão apenas e não
	    devem ser usados em seus arquivos de configuração.  Endentação adequada
	    com tab ou espaços também é importante.</para>
	</note>

      </sect3>

      <sect3>
	<title>Criando nós para dispositivos PPP</title>
	<indexterm><primary>PPP</primary><secondary>creating device nodes</secondary></indexterm>

	<para>Em circunstâncias normais a maioria dos usuários irão apenas
	  precisar de um dispositivo <devicename>tun</devicename>
	  (<devicename>/dev/tun0</devicename>).  Referências ao
	  <devicename>tun0</devicename> acima podem ser trocadas por
	  <devicename>tun<replaceable>N</replaceable></devicename> onde
	  <replaceable>N</replaceable> é qualquer número correspondente
	  em seu sistema.</para>

	<para>Para instalações do FreeBSD que não tenham &man.devfs.5; ativado
	  (FreeBSD&nbsp;4.X e anteriores), a existência do dispositivo
	  <devicename>tun0</devicename> deve ser verificada (isto não é necessário
	  se &man.devfs.5; está ativado pois os nós de dispositivos serão criados
	  sempre que necessário.</para>

	<para>A maneira mais fácil de ter certeza que o dispositivo <devicename>tun0</devicename>
	  está configurado corretamente é refazer o dispositivo.  Para refazer o
	  dispositivo faça o seguinte:</para>

	<screen>&prompt.root; <userinput>cd /dev</userinput>
&prompt.root; <userinput>sh MAKEDEV tun0</userinput></screen>

	<para>Se você tem 16 dispositivos de túnel no seu kernel, você irá
	  precisar criá-los.  Isso pode ser feito executando-se os seguintes
	  comandos:</para>

	<screen>&prompt.root; <userinput>cd /dev</userinput>
&prompt.root; <userinput>sh MAKEDEV tun15</userinput></screen>
      </sect3>

      <sect3>
	<title>Configuração automática do <application>PPP</application></title>

	<indexterm><primary>PPP</primary><secondary>configuration</secondary></indexterm>
	<para>Tanto <command>ppp</command> quanto <command>pppd</command>
	  (a implementação do PPP em modo kernel) usam os arquivos
	  de configuração localizados no diretório <filename>/etc/ppp</filename>.
	  Exemplos para ppp em modo usuário podem ser encontrados em
	  <filename>/usr/share/examples/ppp/</filename>.</para>

	<para>A configuração do <command>ppp</command> requer que você edite
	  vários arquivos, dependendo dos seus requerimentos.  O que você
	  coloca neles depende se seu provedor aloca endereços IP estaticamente
	  (ex.  foi dado a você um endereço IP que deve ser usado sempre) ou
	  dinamicamente (ex.  seu endereço IP é trocado cada vez que você
	  se conecta).</para>

	<sect4 id="userppp-staticIP">
	  <title>PPP e endereços IP estáticos</title>

	  <indexterm><primary>PPP</primary><secondary>with static IP addresses</secondary></indexterm>
	  <para>Você terá de editar o arquivo de configuração <filename>/etc/ppp/ppp.conf</filename>.
	  Ele deve ser similar ao exemplo abaixo.</para>

	  <note>
	    <para>Linhas que terminal em um <literal>:</literal> começam
	      na primeira coluna (início da linha)&mdash; todas as outras
	      linhas devem ser endentadas como mostrado utilizando espaços
	      ou tabs.</para>
	  </note>

	  <programlisting>1     default:
2       set log Phase Chat LCP IPCP CCP tun command
3       ident user-ppp VERSION (built COMPILATIONDATE)
4       set device /dev/cuaa0
5       set speed 115200
6       set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \
7		 \"\" AT OK-AT-OK ATE1Q0 OK \\dATDT\\T TIMEOUT 40 CONNECT"
8       set timeout 180
9       enable dns
10
11    nome_do_provedor:
12      set phone "(123) 456 7890"
13      set authname foo
14      set authkey bar
15      set login "TIMEOUT 10 \"\" \"\" gin:--gin: \\U word: \\P col: ppp"
16      set timeout 300
17      set ifaddr <replaceable>x.x.x.x</replaceable> <replaceable>y.y.y.y</replaceable> 255.255.255.255 0.0.0.0
18      add default HISADDR</programlisting>

	  <variablelist>
	    <varlistentry>
	      <term>Linha 1:</term>

	      <listitem>
		<para>Identifica a entrada padrão.  Comandos nessa entrada são
		  executados automaticamente quando o ppp é executado.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 2:</term>

	      <listitem>
		<para>
		<para>Ativa parâmetros de logging.  Quando a configuração estiver
		  funcionando de acordo, essa linha deve ser reduzida para algo
		  como

		  <programlisting>set log phase tun</programlisting>

		  para evitar que o arquivo de log fique com um tamanho excessivo.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 3:</term>

	      <listitem>
		<para>Diz ao PPP como se identificar para a ponta remota.
		  PPP se identifica com a ponta remota se ele tem qualquer
		  problema na negociação e no ajuste do <literal>link</literal>,
		  provendo informações que o administrador remoto pode achar
		  útil na investigação de problemas.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 4:</term>

	      <listitem>
		<para>Identifica o dispositivo ao qual o modem está conectado.
		  <devicename>COM1</devicename> é <devicename>/dev/cuaa0</devicename>
		  e <devicename>COM2</devicename> é <devicename>/dev/cuaa1</devicename>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 5:</term>

	      <listitem>
		<para>Define a velocidade que você deseja se conectar.  Se 115200
		  não funcionar (deveria com qualquer modem relativamente novo)
		  tente 38400.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linhas 6 & 7:</term>

	      <indexterm><primary>PPP</primary><secondary>user PPP</secondary></indexterm>
	      <listitem>
		<para>A string de discagem.  PPP em modo usuário usa uma <literal>string</literal>
		  similar ao programa &man.chat.8;.  Veja a página manual para informações
		  sobre as funcionalidades dessa linguagem.</para>

		<para>Note que esse comando continua na próxima linha por questões
		   de legibilidade.  Qualquer comando no <filename>ppp.conf</filename>
		   pode fazer isso se o último caractere na linha é o caractere
		   ``\''.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 8:</term>

	      <listitem>
		<para>Define o tempo máximo de inatividade do link.  180 segundos
		  é o padrão e essa linha serve apenas para reforçar isso.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 9:</term>

	      <listitem>
		<para>Diz ao PPP para que ele peça a ponta remota que confirme
		  as configurações do <foreignphrase>resolver</foreignphrase>
		  local.  Se você roda um servidor de nomes, essa linha
		  deve ser comentada ou removida.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 10:</term>

	      <listitem>
		<para>Uma linha em branco para legibilidade.  Linhas em branco
		são ignoradas pelo PPP.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 11:</term>

	      <listitem>
		<para>Identifica uma entrada para um provedor chamado
		  <quote>provedor</quote>.  Isso deve ser trocado pelo
		    nome do seu provedor para que mais tarde você
		    possa utilizar a opção <option>load ISP</option>
		    para iniciar a conexão.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 12:</term>

	      <listitem>
		<para>Define o número telefônico para esse provedor.  Vários
		  números podem ser especificados usando dois pontos
		  (<literal>:</literal>) ou o caractere
		  <foreignphrase>pipe</foreignphrase> (<literal>|</literal>)
		  como separação.  A diferença entre os dois separadores está
		  descrita em &man.ppp.8;.  Resumindo, se você deseja que todos
		  os números sejam utilizados de forma rotatória utilize os dois
		  pontos.  Se você quer que o PPP sempre tente o primeiro número e
		  só utilize os próximos caso o primeiro falhe, utilize o
		  <foreignphrase>pipe</foreignphrase>.  Sempre coloque os números
		  entre aspas.</para>
	
	      <para>Você deve colocar o número telefônico entre aspas
		(<literal>"</literal>) se você tem a intenção de utilizar
		espaços entres os números.  Se você não utilizar aspas quando
		houverem espaços um erro acontecerá.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 13 & 14:</term>

	      <listitem>
		<para>Identifica o nome do usuário e a senha.  Quando
		  se conectar utilizando um prompt de login no estilo
		  &unix; esses valores são utilizados pelo comando
		  <command>set login</command> usando as variáveis \U
		  e \P.  Quando se conectar utilizando PAP ou CHAP esses
		  valores são usados no momento da autenticação.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 15:</term>

	      <listitem>
		<indexterm><primary>PAP</primary></indexterm>
		<indexterm><primary>CHAP</primary></indexterm>
		<para>Se você está utilizando PAP ou CHAP, não haverá nenhum
		  login e essa linha deve ser comentada ou removida.  Veja
		  <link linkend="userppp-PAPnCHAP">autenticação PAP e CHAP</link>
		  para maiores detalhes.</para>

		<para>A string de login tem a mesma sintaxe que a string
		  de discagem.  Nesse exemplo, a string funciona para um
		  serviço que tem uma sessão de login que se parece com isso:</para>

		<screen>J.  Random Provider
login: <replaceable>foo</replaceable>
password: <replaceable>bar</replaceable>
protocol: ppp</screen>

		<para>Você precisará alterar esse script para adequá-lo
		  as suas necessidades.  Quando você estiver alterando este
		  script pela primeira vez você deve ter certeza de ter
		  ativado o logging de <quote>chat</quote> para que você
		  consiga determinar se a conversação está se dando como
		  esperado.
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 16:</term>

	      <indexterm><primary>timeout</primary></indexterm>
	      <listitem>
		<para>Ajusta o tempo máximo de inatividade (em segundos)
		  para a conexão.  No exemplo a conexão será automaticamente
		  fechada após 300 segundos de inatividade.  Se você deseja
		  que a conexão nunca seja fechada, defina este valor para
		  zero ou utilize a opção <option>-ddial</option> na linha
		  de comando.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 17:</term>
	      <indexterm><primary>ISP</primary></indexterm>
	      <listitem>
		<para>Ajusta o endereço da interface.  A string
		<replaceable>x.x.x.x</replaceable> deve ser trocada
		pelo endereço IP que seu provedor lhe alocou.  A string
		<replaceable>y.y.y.y</replaceable> deve ser trocada
		pelo endereço IP que seu provedor lhe indicou como
		sendo o seu gateway (a máquina a qual você se conecta).
		Se seu provedor não lhe forneceu um gateway, utilize
		<hostid role="netmask">10.0.0.2/0</hostid>.  Se você
		precisa <quote>chutar</quote> um endereço, tenha certeza
		de que você criou uma entrada em <filename>/etc/ppp/ppp.linkup</filename>
		de acordo com as instruções de <link linkend="userppp-dynamicIP">
		PPP e Endereços Dinâmicos</link>.  Se essa linha for omitida,
		o <command>ppp</command> não poderá rodar em modo
		<option>-auto</option>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 18:</term>

	      <listitem>
		<para>Adiciona a rota padrão para o gateway do seu provedor.
		  A palavra especial <literal>HISADDR</literal> é trocada
		  pelo gateway especificado na linha 9.  É importante que
		  essa linha apareça após a linha 9, caso contrário
		  a variável <literal>HISADDR</literal> não terá sido
		  inicializada ainda.

		<para>Se você não deseja rodar o ppp com a opção <option>-auto</option>,
		  essa linha deve ser movida para o arquivo <filename>ppp.linkup</filename>.</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>

	  <para>Não é necessário adicionar uma entrada ao arquivo
	    <filename>ppp.linkup</filename> quando você tem um endereço
	    IP estático e está rodando ppp com a opção <option>-auto</option> pois
	    sua tabela de roteamento já estará correta antes de você se
	    conectar.  Entretanto você pode querer criar uma entrada para
	    executar certos programas após a conexão ter sido estabelecida.
	    Isso será explicado mais tarde com o exemplo do sendmail.</para>

	  <para>Arquivos de configuração de exemplo podem ser encontrados
	    no diretório <filename>/usr/share/examples/ppp/</filename>.</para>
	</sect4>

	<sect4 id="userppp-dynamicIP">
	  <title>PPP e Endereços IP Dinâmicos</title>
	  <indexterm><primary>PPP</primary><secondary>with dynamic IP addresses</secondary></indexterm>
	  <indexterm><primary>IPCP</primary></indexterm>
	  <para>Se seu provedor não definiu nenhum endereço IP estático,
	    o <command>ppp</command> pode ser configurado para negociar
	    o endereço local e o remoto.  Isso é feito quando você
	    <quote>chuta</quote> um endereço IP qualquer e deixa
	    que o <command>ppp</command> ajuste ele de acordo através
	    da utilização do IP Configuration Protocol (IPCP) depois
	    de se conectar.  A configuração do <filename>ppp.conf</filename>
	    é a mesma da configuração do <link linkend="userppp-staticIP">PPP
	    e Endereços IP estáticos</link>, com as seguintes mudanças:</para>

	  <programlisting>17      set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.255</programlisting>

	  <para>Novamente, não inclua o número da linha.  Ele está lá
	    apenas para referência.  Endentação ou pelo menos um espaço
	    é requerido.</para>

	  <variablelist>
	    <varlistentry>
	      <term>Linha 17:</term>

	      <listitem>
		<para>O número após o caractere <literal>/</literal> é o
		  número de bits do endereço que o ppp vai insistir que
		  seja utilizado na negociação.  Você pode querer utilizar
		  números IP mais adequados a sua situação mas o
		  exemplo acima sempre irá funcionar.</para>

		<para>O último argumento (<literal>0.0.0.0</literal>) diz
		  ao PPP para iniciar qualquer negociação utilizando
		  o endereço  <hostid role="ipaddr">0.0.0.0</hostid> invés
		  do endereço <hostid role="ipaddr">10.0.0.1</hostid> e é
		  necessário para alguns provedores.  Não use <literal>0.0.0.0</literal>
		  como primeiro argumento de <command>set ifaddr</command> pois
		  isso não permitirá que o PPP ajuste uma rota inicial quando
		  a opção <option>-auto</option> for utilizada na linha
		  de comando.</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>

	  <para>Se você não está rodando em modo <option>-auto</option>, você
	    irá precisar criar uma entrada no <filename>/etc/ppp/ppp.linkup</filename>.
	    Este arquivo é utilizado após a conexão ter sido
	    estabelecida.  Nesse momento, o <command>ppp</command> irá
	    ter definido os endereços da interface e será agora possível
	    adicionar entradas na tabela de roteamento:</para>
	
	  <programlisting>1     nome_do_provedor:
2      add default HISADDR</programlisting>

	  <variablelist>
	    <varlistentry>
	      <term>Linha 1:</term>

	      <listitem>
		<para>No momento de se estabelecer uma conexão,
		  o <command>ppp</command> irá procurar por uma
		  entrada no <filename>ppp.linkup</filename> seguindo
		  as seguintes regras: Primeiro, tente encontrar o
		  mesmo nome que nós utilizamos em <filename>ppp.conf</filename>
		  para a conexão.  Se isso falhar, procure por uma entrada
		  para o endereço IP do nosso gateway.  Se nós ainda
		  não conseguimos encontrar uma entrada, procure pela
		  entrada <literal>MYADDR</literal>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 2:</term>

	      <listitem>
		<para>Essa linha diz ao <command>ppp</command> para adicionar
		  a rota padrão que aponta para <literal>HISADDR</literal>.
		  <literal>HISADDR</literal> será trocado pelo endereço IP
		  do nosso gateway que foi negociado pelo IPCP.</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>

	  <para>Veja a entrada <literal>pmdemand</literal> nos arquivos
	    <filename>/usr/share/examples/ppp/ppp.conf.sample</filename>
	    e
	    <filename>/usr/share/examples/ppp/ppp.linkup.sample</filename>
	    para um exemplo mais detalhado.</para>
	</sect4>

	<sect4>
	  <title>Recebendo Chamadas</title>
	  <indexterm><primary>PPP</primary><secondary>receiving
	  incoming calls</secondary></indexterm>
	  <para>Quando você configura o <application>ppp</application> para
	    receber ligações em uma máquina conectada a uma LAN, você precisa
	    decidir se você deseja que ela passe adiante os pacotes para a
	    LAN.  Se você quer isso, você deve alocar para a ponta remota um endereço IP
	    de sua LAN e utilizar o comando <command>enable proxy</command> no
	    <filename>/etc/ppp/ppp.conf</filename>.  Você deve também confirmar
	    que o arquivo <filename>/etc/rc.conf</filename> contém a
	    seguinte linha:</para>

	  <programlisting>gateway_enable="YES"</programlisting>
	</sect4>

	  <sect4>
	    <title>Qual getty?</title>

	    <para><link linkend="dialup">Configurando o FreeBSD para Serviços
	      Discados</link> fornece uma boa descrição de como ativar serviços
	      discados usando &man.getty.8;.</para>

	    <para>Uma alternativa para o <command>getty</command> é o
	     <ulink url="http://www.leo.org/~doering/mgetty/index.html">mgetty</ulink>,
	     uma versão mais inteligente do <command>getty</command> desenvolvida
	     para linhas discadas.</para>

	    <para>A vantagem de se utilizar o <command>mgetty</command> é
	     que ele ativamente <emphasis>fala</emphasis> com os modems.  Isso
	     significa que se a porta está desligada no <filename>/etc/ttys</filename>
	     então seu modem não irá atender o telefone.</para>

	    <para>Versões mais recentes do <command>mgetty</command> (de
	      0.99beta para frente) também suportam a detecção automática
	      de conexões PPP, permitindo a seus clientes que se conectem
	      ao seu servidor sem a utilização de scripts.</para>

	    <para>Veja <link linkend="userppp-mgetty">Mgetty e Auto-PPP</link>
	      para maiores informações sobre o <command>mgetty</command>.</para>
	  </sect4>

	  <sect4>
	    <title>Permissões do <application>PPP</application></title>

	    <para>O comando <command>ppp</command> precisa normalmente
	      ser executado como <username>root</username>.  Se entretanto,
	      você deseja permitir que ele seja executado no modo
	      servidor por um usuário normal, este usuário precisa que lhe
	      seja garantida a permissão de execução para o <command>ppp</command>
	      através da adição deste usuário ao grupo <username>network</username>
	      no arquivo <filename>/etc/group</filename>.</para>

	    <para>Você também precisará dar acesso a uma ou mais seções
	      do arquivo de configuração usando o comando <command>allow</command>:</para>

	    <programlisting>allow users fred mary</programlisting>

	    <para>Se o comando for utilizado na seção <literal>default</literal>,
	      ele garante que os usuários especificados terão acesso a tudo.</para>
	  </sect4>

	  <sect4>
	    <title>Shells PPP e Usuários de IPs Dinâmicos</title>
	    <indexterm><primary>PPP shells</primary></indexterm>

	    <para>Crie um arquivo chamado <filename>/etc/ppp/ppp-shell</filename>
	      contendo o seguinte:</para>

	    <programlisting>#!/bin/sh
IDENT=`echo $0 | sed -e 's/^.*-\(.*\)$/\1/'`
CALLEDAS="$IDENT"
TTY=`tty`

if [ x$IDENT = xdialup ]; then
	IDENT=`basename $TTY`
fi

echo "PPP for $CALLEDAS on $TTY"
echo "Starting PPP for $IDENT"

exec /usr/sbin/ppp -direct $IDENT</programlisting>

	    <para>Esse script deve ser executável.  Agora crie um link simbólico
	      chamado <filename>ppp-dialup</filename> para este script usando
	      o seguinte comando:</para>

	    <screen>&prompt.root; <userinput>ln -s ppp-shell /etc/ppp/ppp-dialup</userinput></screen>

	    <para>Você deve usar este script como a <emphasis>shell</emphasis> para todos
	      os seus usuários discados.  Este é um exemplo do <filename>/etc/passwd</filename>
	      para um usuário de discado chamado <username>pchilds</username> (lembre-se
	      de não editar o arquivo de senhas diretamente, utilize o <command>vipw</command>).</para>

	    <programlisting>pchilds:*:1011:300:Peter Childs PPP:/home/ppp:/etc/ppp/ppp-dialup</programlisting>

	    <para>Crie um diretório chamado <filename>/home/ppp</filename> que
	      possa ser lido por qualquer usuário contendo os seguintes
	      arquivos vazios:</para>

	    <screen>-r--r--r--   1 root     wheel	   0 May 27 02:23 .hushlogin
-r--r--r--   1 root     wheel	   0 May 27 02:22 .rhosts</screen>

	    <para>que farão com que o <filename>/etc/motd</filename>
	      não seja mostrado.</para>
	  </sect4>

	  <sect4>
	    <title>Shells PPP para Usuários de IPs Estáticos</title>
	    <indexterm><primary>PPP shells</primary></indexterm>

	    <para>Crie o arquivo <filename>ppp-shell</filename> como mostrado
	      acima e para cada conta que tenha um IP estático definido crie
	      um link simbólico para <filename>ppp-shell</filename>.</para>

	    <para>Por exemplo, se você tem três clientes discados,
	      <username>fred</username>, <username>sam</username>, e
	      <username>mary</username>, que você faz roteamento de redes
	      classe C para eles, você deve digitar o seguinte:</para>

	    <screen>&prompt.root; <userinput>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-fred</userinput>
&prompt.root; <userinput>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-sam</userinput>
&prompt.root; <userinput>ln -s /etc/ppp/ppp-shell /etc/ppp/ppp-mary</userinput></screen>

	    <para>Cada um desses usuários deve ter sua shell definida para o
	      link simbólico criado acima (por exemplo, a shell do usuário
	      <username>mary</username> deve ser <filename>/etc/ppp/ppp-mary</filename>).</para>
	  </sect4>

	  <sect4>
	    <title>Ajustando o <filename>ppp.conf</filename> para Usuários de IPs Dinâmicos</title>
	
	    <para>O arquivo <filename>/etc/ppp/ppp.conf</filename> deve conter
	      algo parecido com o seguinte:</para>
	
	    <programlisting>default:
  set debug phase lcp chat
  set timeout 0

ttyd0:
  set ifaddr 203.14.100.1 203.14.100.20 255.255.255.255
  enable proxy

ttyd1:
  set ifaddr 203.14.100.1 203.14.100.21 255.255.255.255
  enable proxy</programlisting>

	    <note>
	      <para>A endentação é importante.</para>
	    </note>

	    <para>A seção <literal>default:</literal> é carregada para cada
	      sessão.  Para cada linha discada ativada no <filename>/etc/ttys</filename>
	      você deve criar uma entrada similar a <literal>ttyd0:</literal> abaixo.
	      Cada linha deve ter um endereço IP único dentre os IPs disponíveis
	      para os usuários dinâmicos.</para>
	  </sect4>

	  <sect4>
	    <title>Ajustando o <filename>ppp.conf</filename> para Usuários de IPs Estáticos</title>

	    <para>Junto com o conteúdo do arquivo de exemplo
	      <filename>/usr/share/examples/ppp/ppp.conf</filename>
	      acima você deve adicionar uma seção para cada usuário
	      estático.  Nós iremos continuar com os usuários <username>fred</username>,
	      <username>sam</username> e <username>mary</username> como exemplo.</para>

	    <programlisting>fred:
  set ifaddr 203.14.100.1 203.14.101.1 255.255.255.255

sam:
  set ifaddr 203.14.100.1 203.14.102.1 255.255.255.255

mary:
  set ifaddr 203.14.100.1 203.14.103.1 255.255.255.255</programlisting>

	    <para>O arquivo <filename>/etc/ppp/ppp.linkup</filename>
	      deve também conter informações de roteamento para cada
	      endereço IP estático se isso for necessário.  A linha abaixo
	      irá adicionar uma rota para a rede classe C
	      <hostid role="ipaddr">203.14.101.0</hostid> através
	      do link PPP do cliente.</para>

	    <programlisting>fred:
  add 203.14.101.0 netmask 255.255.255.0 HISADDR

sam:
  add 203.14.102.0 netmask 255.255.255.0 HISADDR

mary:
  add 203.14.103.0 netmask 255.255.255.0 HISADDR</programlisting>
	</sect4>

	  <sect4 id="userppp-mgetty">
	    <title><command>mgetty</command> e AutoPPP</title>
	    <indexterm>
	<primary><command>mgetty</command></primary>
      </indexterm>
	    <indexterm><primary>AutoPPP</primary></indexterm>
	    <indexterm><primary>LCP</primary></indexterm>

	    <para>Configurar e compilar o <command>mgetty</command> com
	      a opção <literal>AUTO_PPP</literal> ativada permite que o
	      <command>mgetty</command> detecte a fase LCP da conexão
	      PPP e automaticamente inicie uma shell ppp.  Entretanto,
	      já que a seqüência de usuário/senha padrão não ocorre é
	      necessário autenticar os usuários usando PAP ou CHAP.</para>

	    <para>Essa seção assume que o usuário tenha configurado,
	      compilado e instalado uma versão do <command>mgetty</command>
	      com a opção <literal>AUTO_PPP</literal> (v0.99beta ou
	      superior).</para>

	    <para>Tenha certeza de que o arquivo <filename>/usr/local/etc/mgetty+sendfax/login.config</filename>
	      contenha o seguinte:</para>

	    <programlisting>/AutoPPP/ -     -		      /etc/ppp/ppp-pap-dialup</programlisting>

	    <para>Isso irá fazer com que o <command>mgetty</command> rode
	      o script <filename>ppp-pap-dialup</filename> para as
	      conexões PPP que ele detectar.</para>

	    <para>Crie um arquivo chamado <filename>/etc/ppp/ppp-pap-dialup</filename>
	      contendo o seguinte (esse arquivo deve ser executável):</para>

	    <programlisting>#!/bin/sh
exec /usr/sbin/ppp -direct pap$IDENT</programlisting>

	    <para>Para cada linha discada ativado em <filename>/etc/ttys</filename>,
	      crie uma entrada correspondente em <filename>/etc/ppp/ppp.conf</filename>.
	      Isso irá coexistir normalmente com nossas definições acima.</para>

	    <programlisting>pap:
  enable pap	
  set ifaddr 203.14.100.1 203.14.100.20-203.14.100.40
  enable proxy</programlisting>

	    <para>Cada usuário se conectando com esse método precisará de um
	      usuário/senha no arquivo <filename>/etc/ppp/ppp.secret</filename>
	      ou você pode adicionar a seguinte opção para autenticar os usuários
	      através do arquivo <filename>/etc/password</filename>.</para>

	    <programlisting>enable passwdauth</programlisting>

	    <para>Se você deseja definir um endereço IP estático para alguns
	      usuário você pode especificar o endereço como o terceiro argumento
	      no <filename>/etc/ppp/ppp.secret</filename>.  Veja o
	      <filename>/usr/share/examples/ppp/ppp.secret.sample</filename>
	      para mais exemplos.</para>
	  </sect4>

	  <sect4>
	    <title>Extensões MS</title>
	    <indexterm><primary>DNS</primary></indexterm>
	    <indexterm><primary>NetBIOS</primary></indexterm>
	    <indexterm><primary>PPP</primary><secondary>Microsoft extensions</secondary></indexterm>
	    <para>É possível configurar o PPP para fornecer endereços
	      de DNS e NetBIOS de acordo com a demanda.</para>

	    <para>Para ativar essas extensões na versão 1.x do PPP, as
	      seguintes linhas podem ser adicionadas a seção relevante
	      do <filename>/etc/ppp/ppp.conf</filename>.</para>

	    <programlisting>enable msext
set ns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</programlisting>

	    <para>E para o PPP versão 2 ou superior:</para>

	    <programlisting>accept dns
set dns 203.14.100.1 203.14.100.2
set nbns 203.14.100.5</programlisting>

	    <para>Isso irá fornecer aos clientes o endereço do servidor
	      primário e secundário de DNS e o servidor de NetBIOS.</para>

	    <para>Na versão 2 ou superior, se a linha <literal>set dns</literal>
	      for omitida, o PPP irá usar os valores encontrados no
	      <filename>/etc/resolv.conf</filename>.</para>
	</sect4>

	<sect4 id="userppp-PAPnCHAP">
	  <title>Autenticação PAP e CHAP</title>
	  <indexterm><primary>PAP</primary></indexterm>	
	  <indexterm><primary>CHAP</primary></indexterm>	
	  <para>Alguns provedores definem seus sistemas de forma que a parte
	    de autenticação da sua conexão é feita usando os mecanismos
	    de autenticação PAP ou CHAP.  Se esse for o caso, seu provedor
	    não irá lhe dar um prompt <prompt>login:</prompt> quando você
	    se conectar, mas sim irá iniciar a comunicação PPP imediatamente.</para>

	  <para>PAP é menos seguro que CHAP, mas segurança não é normalmente
	    uma preocupação aqui já que as senhas, mesmo sendo enviadas
	    em texto puro com PAP, estão sendo transmitidas através da
	    linha serial apenas.  Não existe muitas possibilidades para
	    que crackers vejam ela.</para>

	  <para>Utilizando o que vimos nas seções <link linkend="userppp-staticIP">PPP
	    e Endereços IP Estáticos</link> ou <link linkend="userppp-dynamicIP">
	    PPP e Endereços IP Dinâmicos</link>, as seguintes alterações devem
	    ser feitas:</para>

	  <programlisting>7       set login
&hellip;
12      set authname <replaceable>MeuUsuario</replaceable>
13      set authkey <replaceable>MinhaSenha</replaceable></programlisting>

	  <variablelist>
	    <varlistentry>
	      <term>Linha 7:</term>

	      <listitem>
		<para>Seu provedor não irá, normalmente, requerer que você entre no
		  servidor se estiver usando PAP ou CHAP.  Você deve
		  desabilitar a string <quote>set login</quote> neste
		  caso.
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 12:</term>

	      <listitem>
		<para>Essa linha especifica seu nome de usuário PAP/CHAP.  Você
		  precisará inserir o valor correto para <replaceable>MeuUsuario</replaceable>.</para>
	      </listitem>
	    </varlistentry>

	    <varlistentry>
	      <term>Linha 13:</term>
	      <indexterm><primary>password</primary></indexterm>
	      <listitem>
		<para>Essa linha especifica sua senha PAP/CHAP.  Você precisará
		inserir o valor correto para <replaceable>MinhaSenha</replaceable>.
		Você pode adicionar uma linha adicional como abaixo:</para>
		
		<programlisting>15      accept PAP</programlisting>

		<para>ou</para>

		<programlisting>15      accept CHAP</programlisting>

		<para>para deixar claro que esta é sua intenção, mas PAP
		  e CHAP são todos aceitos por padrão.</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>
	</sect4>

	<sect4>
	  <title>Mudando a Configuração do <command>ppp</command> <quote>on the
	    Fly</quote></title>

	  <para>É possível conversar com o programa <command>ppp</command>
	    enquanto ele está executando em segundo plano, mas apenas se
	    uma porta de diagnósticos for configurada.  Para fazer isso,
	    adicione a seguinte linha a sua configuração:</para>

	  <programlisting>set server /var/run/ppp-tun<replaceable>%d</replaceable> DiagnosticPassword 0177</programlisting>

	  <para>Isso fará com que o PPP ouça no socket &unix; especificado,
	    perguntando aos clientes a senha antes de permitir o acesso.  O
	    <literal>%d</literal> no nome é trocado pelo número do dispositivo
	    <devicename>tun</devicename> que está em uso.</para>

	  <para>Uma vez que um socket foi ajustado, o programa &man.pppctl.8;
	    pode ser utilizado em scripts que desejem manipular o programa
	    em tempo de execução.</para>
	</sect4>
      </sect3>

      <sect3 id="userppp-nat">
       <title>Usando o Recurso de NAT do PPP</title>
       <indexterm><primary>PPP</primary><secondary>NAT</secondary></indexterm>

       <para>O PPP tem a habilidade de fazer NAT (Network Address Translation) sem
	 precisar utilizar as capacidades de <foreignphrase>divert</foreignphrase>
	 do kernel.  Essa funcionalidade pode ser ativada através da seguinte
	 linha no <filename>/etc/ppp/ppp.conf</filename>:</para>

       <programlisting>nat enable yes</programlisting>

       <para>Outra maneira de ativar o NAT do PPP é pela linha de
	 comando <literal>-nat</literal>.  Existe também uma opção
	 no <filename>/etc/rc.conf</filename> chamada <literal>ppp_nat</literal>
	 que é ativada por padrão.</para>

       <para>Se você for usar essa funcionalidade, você também pode achar
	 útil as seguintes opções em <filename>/etc/ppp/ppp.conf</filename>
	 para ativar o encaminhamento de conexões entrantes:</para>

       <programlisting>nat port tcp 10.0.0.2:ftp ftp
nat port tcp 10.0.0.2:http http</programlisting>

       <para>ou não confie no exterior</para>

       <programlisting>nat deny_incoming yes</programlisting>
      </sect3>

      <sect3 id="userppp-final">
	<title>Configuração Final do Sistema</title>
	<indexterm><primary>PPP</primary><secondary>configuration</secondary></indexterm>

	<para>Você agora tem o <command>ppp</command> configurado, mas existem
	  mais algumas coisas a serem feitas antes que o show comece.  Todas
	  elas envolvem editar o arquivo <filename>/etc/rc.conf</filename>.

	<para>Certifique-se de que a linha <literal>hostname=</literal>
	  está definida, ex.:</para>

	<programlisting>hostname="foo.example.com"</programlisting>

	<para>Se seu provedor lhe forneceu um endereço IP estático e
	  um nome, é melhor que você use este nome como seu hostname.</para>

	<para>Veja a variável <literal>network_interfaces</literal>.  Se você
	  quer configurar seu sistema de modo que ele disque para seu
	  provedor conforme necessário, tenha certeza de que o dispositivo
	  <devicename>tun0</devicename> está adicionado a lista, do contrário
	  remova-o.</para>

	<programlisting>network_interfaces="lo0 tun0"
ifconfig_tun0=</programlisting>

	<note>
	  <para>A variável <literal>ifconfig_tun0</literal> deve estar
	    vazia, e um arquivo chamado <filename>/etc/start_if.tun0</filename>
	    deve ser criado.  Esse arquivo deve conter a linha:</para>

	  <programlisting>ppp -auto nome_do_provedor</programlisting>

	  <para>Esse script é executado no momento da configuração de rede,
	    iniciando seu daemon ppp em modo automático.  Se você tem uma
	    rede local para a qual esta máquina é o gateway, você pode
	    desejar usar a opção <option>-alias</option>.  Veja a página
	    manual para maiores detalhes.</para>
	</note>

	<para>Define o programa roteador para <literal>NO</literal> com
	  a seguinte linha no seu <filename>/etc/rc.conf</filename>:</para>

	<programlisting>router_enable="NO"</programlisting>

	<indexterm>
    <primary><application>routed</application></primary>
  </indexterm>
	<para>É importante que o daemon <command>routed</command> não seja
	  iniciado (ele é iniciado por padrão), pois o <command>routed</command>
	  tende a deletar as entradas na tabela de roteamento que foram criadas
	  pelo <command>ppp</command>.</para>

	<para>É importante ter certeza de que a variável <literal>sendmail_flags</literal>
	  não contenha a opção <option>-q</option>, do contrário o
	  <command>sendmail</command> irá tentar fazer uma pesquisa na rede
	  em certos momentos, o que possivelmente irá fazer com que sua máquina
	  disque e tente estabelecer uma conexão de rede.  Você pode tentar:</para>

	<programlisting>sendmail_flags="-bd"</programlisting>

	<indexterm>
    <primary><application>sendmail</application></primary>
  </indexterm>
	<para>A desvantagem disso é que você precisa forçar o
	  <command>sendmail</command> a re-examinar sua fila
	  de correio sempre que o link ppp for estabelecido
	  digitando na linha de comando o seguinte:</para>

	<screen>&prompt.root; <userinput>/usr/sbin/sendmail -q</userinput></screen>

	<para>Se você deseja utilizar o comando <command>!bg</command> no
	  arquivo <filename>ppp.linkup</filename> para fazer isso
	  automaticamente:</para>

	<programlisting>1     nome_do_provedor:
2       delete ALL
3       add 0 0 HISADDR
4       !bg sendmail -bd -q30m</programlisting>

	<indexterm><primary>SMTP</primary></indexterm>
	<para>Se você não gosta disso, é possível ajustar um
	  <quote>dfilter</quote> para bloquear o tráfego SMTP.  Veja
	  os arquivos de exemplo para maiores detalhes.</para>

	<para>Agora o último passo é reiniciar a máquina.  Depois disso,
	  você pode digitar:</para>

	<screen>&prompt.root; <userinput>ppp</userinput></screen>

	<para>e então <command>dial nome_do_provedor</command> para iniciar uma
	  sessão PPP, ou, se você quer que o <command>ppp</command>
	  estabelece as sessões automaticamente quando existir tráfego de
	  saída (e você não criou o script <filename>start_if.tun0</filename>,
	  digite:</para>

	<screen>&prompt.root; <userinput>ppp -auto nome_do_provedor</userinput></screen>
      </sect3>

      <sect3>
	<title>Sumário</title>

	<para>Re-capitulando, os seguintes passos são necessários para ajustar
	  o ppp pela primeira vez:</para>

	<para>No cliente:</para>

	<procedure>
	  <step>
	    <para>Certificar-se de que o dispositivo <devicename>tun</devicename>
	      está definido no seu kernel.</para>
	  </step>

	  <step>
	    <para>Certificar-se de que o dispositivo <filename>tun<replaceable>N</replaceable></filename>
	      está disponível no diretório <filename>/dev</filename>.</para>
	  </step>

	  <step>
	    <para>Criar uma entrada no <filename>/etc/ppp/ppp.conf</filename>.
	      O arquivo de exemplo <filename>pmdemand</filename> deve ser
	      suficiente para a maioria dos provedores.</para>
	  </step>

	  <step>
	    <para>Se você tem um endereço IP dinâmico, crie uma entrada no
	      arquivo <filename>/etc/ppp/ppp.linkup</filename>.</para>
	  </step>

	  <step>
	    <para>Atualize seu arquivo <filename>/etc/rc.conf</filename>.</para>
	  </step>

	  <step>
	    <para>Crie o script <filename>start_if.tun0</filename> se você
	      precisa que o sistema liga de acordo com a demanda.</para>
	  </step>
	</procedure>

	<para>No Servidor:</para>

	<procedure>
	  <step>
	    <para>Certificar-se de que o dispositivo <devicename>tun</devicename>
	      está no seu kernel.</para>
	  </step>

	  <step>
	    <para>Certificar-se de que o dispositivo <filename>tun<replaceable>N</replaceable></filename>
	      está disponível no diretório <filename>/dev</filename>.</para>
	  </step>

	  <step>
	    <para>Criar uma entrada no <filename>/etc/passwd</filename>
	      (usando o programa &man.vipw.8;).</para>
	  </step>

	  <step>
	    <para>Crie um perfil nesse diretório de usuários que rode
	      o comando <command>ppp -direct direct-server</command>
	      ou similar.</para>
	  </step>

	  <step>
	    <para>Crie uma entrada no arquivo <filename>/etc/ppp/ppp.conf</filename>.
	      O arquivo de exemplo <filename>direct-server</filename> deve
	      ser suficiente.</para>
	  </step>

	  <step>
	    <para>Crie uma entrada no <filename>/etc/ppp/ppp.linkup</filename>.</para>
	  </step>

	  <step>
	    <para>Atualize seu arquivo <filename>/etc/rc.conf</filename>.</para>
	  </step>
	</procedure>
      </sect3>
    </sect2>
  </sect1>

  <sect1 id="ppp">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Gennady B.</firstname>
	  <surname>Sorokopud</surname>
	  <contrib>Partes originalmente contribuidas por </contrib>
	</author>
	<author>
	  <firstname>Robert</firstname>
	  <surname>Huff</surname>
	</author>
      </authorgroup>
    </sect1info>

    <title>Usando PPP em modo kernel</title>

    <sect2>
      <title>PPP em modo kernel</title>
      <indexterm><primary>PPP</primary><secondary>kernel PPP</secondary></indexterm>

      <para>Antes que você inicie o ajuste do PPP na sua máquina, certifique-se
	de que o <command>pppd</command> está no diretório <filename>/usr/sbin</filename>
	e que o diretório <filename>/etc/ppp</filename> existe.</para>

      <para>O <command>pppd</command> pode funcionar de dois modos:</para>

      <orderedlist>
	<listitem>
	  <para>Como um <quote>cliente</quote> &mdash; você quer conectar sua
	    máquina com o mundo exterior através de uma conexão PPP serial ou
	    de um de modem.</para>
	</listitem>

	<indexterm><primary>PPP</primary><secondary>server</secondary></indexterm>
	<listitem>
	  <para>Como um <quote>servidor</quote> &mdash; sua máquina está localizada
	    em uma rede e é utilizada para conectar outros computadores através de
	    PPP.</para>
	</listitem>
      </orderedlist>

      <para>Nos dois casos você deverá ajustar o arquivo de opções
	(<filename>/etc/ppp/options</filename> ou <filename>~/.ppprc</filename>
	se você tem mais de um usuário na máquina que utiliza PPP).</para>

      <para>Você irá também precisar de um software para modem/serial (preferencialmente
	<filename role="package">comms/kermit</filename>), para que você possa
	discar e estabelecer uma conexão com a máquina remota.</para>
    </sect2>

    <sect2>
      <sect2info>
	<authorgroup>
	  <author>
	    <firstname>Trev</firstname>
	    <surname>Roydhouse</surname>
	    <contrib>Baseado em informações providas por </contrib>
	    <!-- Trev.Roydhouse@f401.n711.z3.fidonet.org -->
	  </author>
	</authorgroup>
      </sect2info>
	
      <title>Usando o <command>pppd</command> como Cliente</title>
      <indexterm><primary>PPP</primary><secondary>client</secondary></indexterm>
      <indexterm><primary>Cisco</primary></indexterm>
      <para>O arquivo <filename>/etc/ppp/options</filename> abaixo pode ser
	utilizado para se conectar a um servidor PPP da Cisco.</para>

      <programlisting>crtscts	 # enable hardware flow control
modem	   # modem control line
noipdefault     # remote PPP server must supply your IP address
		# if the remote host does not send your IP during IPCP
		# negotiation, remove this option
passive	 # wait for LCP packets
domain ppp.foo.com      # put your domain name here

:&lt;remote_ip&gt;    # put the IP of remote PPP host here
		# it will be used to route packets via PPP link
		# if you didn't specified the noipdefault option
		# change this line to &lt;local_ip&gt;:&lt;remote_ip&gt;

defaultroute    # put this if you want that PPP server will be your
		# default router</programlisting>

      <para>Para conectar:</para>

      <indexterm><primary>kermit</primary></indexterm>
      <indexterm><primary>modem</primary></indexterm>
      <procedure>
	<step>
	  <para>Disque para o <literal>host</literal> remoto usando o <application>kermit</application>
	  (ou outro programa para o modem) e digite seu usuário e senha (ou o que quer que seja
	  necessário para ativar PPP no <literal>host</literal> remoto.</para>
	</step>

	<step>
	  <para>Saia do <application>kermit</application> (sem desconectar a linha).</para>
	</step>

	<step>
	  <para>Digite o seguinte:</para>

	  <screen>&prompt.root; <userinput>/usr/src/usr.sbin/pppd.new/pppd <replaceable>/dev/tty01</replaceable> <replaceable>19200</replaceable></userinput></screen>

	  <para>Certifique-se de usar a velocidade e o nome do dispositivo apropriados.</para>
	</step>
      </procedure>

      <para>Agora seu computador está conectado por PPP.  Se a conexão falhar,
	você pode adicionar a opção <option>debug</option> ao arquivo
	<filename>/etc/ppp/options</filename> e verificar as mensagens no
	<literal>console</literal> para diagnosticar o problema.</para>

      <para>O script <filename>/etc/ppp/pppup</filename> abaixo irá fazer os
      3 estágios automaticamente:</para>

      <programlisting>#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
	echo 'killing pppd, PID=' ${pid}
	kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
	echo 'killing kermit, PID=' ${pid}
	kill -9 ${pid}
fi

ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.dial
pppd /dev/tty01 19200</programlisting>

      <indexterm><primary>kermit</primary></indexterm>
      <para><filename>/etc/ppp/kermit.dial</filename> é um script do
      <application>kermit</application> que disca e faz toda a autorização
      necessária no <literal>host</literal> remoto (um exemplo de tal
      script está anexado ao final deste documento).</para>

      <para>Use o seguinte script <filename>/etc/ppp/pppdown</filename>
	para desconectar a linha PPP:</para>

      <programlisting>#!/bin/sh
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
	echo 'killing pppd, PID=' ${pid}
	kill -TERM ${pid}
fi

ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
	echo 'killing kermit, PID=' ${pid}
	kill -9 ${pid}
fi

/sbin/ifconfig ppp0 down
/sbin/ifconfig ppp0 delete
kermit -y /etc/ppp/kermit.hup
/etc/ppp/ppptest</programlisting>

      <para>Verifique se o <command>pppd</command> está ainda executando
	através do comando <filename>/usr/etc/ppp/ppptest</filename>, que
	deverá se parecer com o seguinte:</para>

      <programlisting>#!/bin/sh
pid=`ps ax| grep pppd |grep -v grep|awk '{print $1;}'`
if [ X${pid} != "X" ] ; then
	echo 'pppd running: PID=' ${pid-NONE}
else
	echo 'No pppd running.'
fi
set -x
netstat -n -I ppp0
ifconfig ppp0</programlisting>

      <para>Para desligar, execute o <filename>/etc/ppp/kermit.hup</filename>,
	que deve conter:</para>

      <programlisting>set line /dev/tty01	; put your modem device here
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
echo \13
exit</programlisting>

      <para>Um método alternativo é usar o comando <command>chat</command>
	invés do <command>kermit</command>:</para>

      <para>Os dois arquivos seguintes são suficientes para estabelecer
	uma conexão com <command>pppd</command>.</para>

      <para><filename>/etc/ppp/options</filename>:</para>

      <programlisting>/dev/cuaa1 115200

crtscts		# enable hardware flow control
modem		# modem control line
connect "/usr/bin/chat -f /etc/ppp/login.chat.script"
noipdefault	# remote PPP serve must supply your IP address
		# if the remote host doesn't send your IP during
		# IPCP negotiation, remove this option
passive	 # wait for LCP packets
domain &lt;your.domain&gt;	# put your domain name here

:		# put the IP of remote PPP host here
		# it will be used to route packets via PPP link
		# if you didn't specified the noipdefault option
		# change this line to &lt;local_ip&gt;:&lt;remote_ip&gt;

defaultroute	# put this if you want that PPP server will be
		# your default router</programlisting>

      <para><filename>/etc/ppp/login.chat.script</filename>:</para>

      <note>
	<para>A conteúdo abaixo deve ficar em uma única linha:</para>
      </note>

      <programlisting>ABORT BUSY ABORT 'NO CARRIER' "" AT OK ATDT&lt;phone.number&gt;
  CONNECT "" TIMEOUT 10 ogin:-\\r-ogin: &lt;login-id&gt;
  TIMEOUT 5 sword: &lt;password&gt;</programlisting>

      <para>Uma vez que eles estiverem instalados e modificados corretamente, tudo
	que você precisa fazer é executar o <command>pppd</command> da seguinte
	maneira:</para>

      <screen>&prompt.root; <userinput>pppd</userinput></screen>
    </sect2>

    <sect2>
      <title>Usando o <command>pppd</command> como Servidor</title>

      <para>O arquivo <filename>/etc/ppp/options</filename> deve conter algo
	similar ao seguinte:</para>

      <programlisting>crtscts			 # Hardware flow control
netmask 255.255.255.0	   # netmask (not required)
192.114.208.20:192.114.208.165  # IP's of local and remote hosts
				# local ip must be different from one
				# you assigned to the ethernet (or other)
				# interface on your machine.
				# remote IP is IP address that will be
				# assigned to the remote machine
domain ppp.foo.com	      # your domain
passive			 # wait for LCP
modem			   # modem line</programlisting>

      <para>O script <filename>/etc/ppp/pppserv</filename> abaixo irá fazer
	com que o <application>pppd</application> se comporte como um
	servidor:</para>

      <programlisting>#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
	echo 'killing pppd, PID=' ${pid}
	kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
	echo 'killing kermit, PID=' ${pid}
	kill -9 ${pid}
fi

# reset ppp interface
ifconfig ppp0 down
ifconfig ppp0 delete

# enable autoanswer mode
kermit -y /etc/ppp/kermit.ans

# run ppp
pppd /dev/tty01 19200</programlisting>

      <para>Use o script <filename>/etc/ppp/pppservdown</filename> para
	para o servidor:</para>

      <programlisting>#!/bin/sh
ps ax |grep pppd |grep -v grep
pid=`ps ax |grep pppd |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
	echo 'killing pppd, PID=' ${pid}
	kill ${pid}
fi
ps ax |grep kermit |grep -v grep
pid=`ps ax |grep kermit |grep -v grep|awk '{print $1;}'`
if [ "X${pid}" != "X" ] ; then
	echo 'killing kermit, PID=' ${pid}
	kill -9 ${pid}
fi
ifconfig ppp0 down
ifconfig ppp0 delete

kermit -y /etc/ppp/kermit.noans</programlisting>

      <para>O script para <application>kermit</application> abaixo
	(<filename>/etc/ppp/kermit.ans</filename>) irá ativar/desativar
	o modo de atendimento automático do seu modem.  Ele deve se
	parecer com o seguinte:</para>

      <programlisting>set line /dev/tty01
set speed 19200
set file type binary
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none

pau 1
out +++
inp 5 OK
out ATH0\13
inp 5 OK
echo \13
out ATS0=1\13   ; change this to out ATS0=0\13 if you want to disable
		; autoanswer mode
inp 5 OK
echo \13
exit</programlisting>

      <para>O script chamado <filename>/etc/ppp/kermit.dial</filename> é
	utilizado para discagem e autenticação na máquina remota.  Você
	precisará customizá-lo para suas necessidades.  Coloque seu usuário
	e senha nesse script; você também precisará mudar a indicação
	de entrada dependendo das respostas do seu modem e da máquina
	remota.</para>

      <programlisting>;
; put the com line attached to the modem here:
;
set line /dev/tty01
;
; put the modem speed here:
;
set speed 19200
set file type binary	    ; full 8 bit file xfer
set file names literal
set win 8
set rec pack 1024
set send pack 1024
set block 3
set term bytesize 8
set command bytesize 8
set flow none
set modem hayes
set dial hangup off
set carrier auto		; Then SET CARRIER if necessary,
set dial display on	     ; Then SET DIAL if necessary,
set input echo on
set input timeout proceed
set input case ignore
def \%x 0		       ; login prompt counter
goto slhup

:slcmd			  ; put the modem in command mode
echo Put the modem in command mode.
clear			   ; Clear unread characters from input buffer
pause 1
output +++		      ; hayes escape sequence
input 1 OK\13\10		; wait for OK
if success goto slhup
output \13
pause 1
output at\13
input 1 OK\13\10
if fail goto slcmd	      ; if modem doesn't answer OK, try again

:slhup			  ; hang up the phone
clear			   ; Clear unread characters from input buffer
pause 1
echo Hanging up the phone.
output ath0\13		  ; hayes command for on hook
input 2 OK\13\10
if fail goto slcmd	      ; if no OK answer, put modem in command mode

:sldial			 ; dial the number
pause 1
echo Dialing.
output atdt9,550311\13\10	       ; put phone number here
assign \%x 0		    ; zero the time counter

:look
clear			   ; Clear unread characters from input buffer
increment \%x		   ; Count the seconds
input 1 {CONNECT }
if success goto sllogin
reinput 1 {NO CARRIER\13\10}
if success goto sldial
reinput 1 {NO DIALTONE\13\10}
if success goto slnodial
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if < \%x 60 goto look
else goto slhup

:sllogin			; login
assign \%x 0		    ; zero the time counter
pause 1
echo Looking for login prompt.

:slloop
increment \%x		   ; Count the seconds
clear			   ; Clear unread characters from input buffer
output \13
;
; put your expected login prompt here:
;
input 1 {Username: }
if success goto sluid
reinput 1 {\255}
if success goto slhup
reinput 1 {\127}
if success goto slhup
if < \%x 10 goto slloop	 ; try 10 times to get a login prompt
else goto slhup		 ; hang up and start again if 10 failures

:sluid
;
; put your userid here:
;
output ppp-login\13
input 1 {Password: }
;
; put your password here:
;
output ppp-password\13
input 1 {Entering SLIP mode.}
echo
quit

:slnodial
echo \7No dialtone.  Check the telephone line!\7
exit 1

; local variables:
; mode: csh
; comment-start: "; "
; comment-start-skip: "; "
; end:</programlisting>
    </sect2>
  </sect1>

  <sect1 id="ppp-troubleshoot">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Tom</firstname>
	  <surname>Rhodes</surname>
	  <contrib>Contribuído por </contrib>
	</author>
      </authorgroup>
      <!-- 13 June 2003 -->
    </sect1info>
    <title>Resolução de Problemas</title>

    <indexterm><primary>PPP</primary><secondary>troubleshooting</secondary></indexterm>

      <para>Está seção cobre alguns dos problemas que podem aparecer
	quando você utiliza PPP sobre uma conexão com modem.  Por exemplo,
	talvez você precise saber exatamente qual o <literal>prompt</literal>
	que o sistema remoto irá lhe apresentar.  Alguns provedores
	usam o prompt <literal>ssword</literal> e outros usam
	<literal>password</literal>; se o script <command>ppp</command>
	não for escrito de acordo a autenticação irá falhar.  A maneira
	mais fácil de diagnosticar problemas nas conexões <command>ppp</command>
	e tentar se conectar manualmente.  A seguinte informação vai
	lhe ajudar a realizar este processo passo a passo.</para>

    <sect2>
      <title>Verificar os Nós de Dispositivos</title>

	<para>Se você reconfigurou seu kernel você se lembra do
	  dispositivo <devicename>sio</devicename>.  Se você não
	  reconfigurou seu kernel não precisa se preocupar.  Apenas
	  verifique a saída do comando <command>dmesg</command> e
	  procure pelo dispositivo do modem dessa forma:</para>

	<screen>&prompt.root;<userinput>dmesg | grep sio</userinput></screen>

	<para>Você deve ver alguma informações sobre dispositivos
	  <devicename>sio</devicename>.  Essas são as portas COM que
	  nós precisamos.  Se seu modem age como uma porta serial padrão
	  então você deve ele listado como <devicename>sio1</devicename>,
	  ou COM2.  Neste caso você não precisa recompilar seu kernel,
	  você precisa apenas criar o dispositivo serial.  Você pode
	  fazer isso indo em <filename>/dev</filename> e rodando o
	  script <filename>MAKEDEV</filename> como acima.  Agora crie
	  os dispositivos seriais com:</para>

	<screen>&prompt.root; <userinput>sh MAKEDEV cuaa0 cuaa1 cuaa2 cuaa3</userinput></screen>

	<para>que irá criar os dispositivos seriais para seu sistema.  Se seu
	  modem estiver em <devicename>sio1</devicename> ou <acronym>COM2</acronym>
	  se você está no DOS, então este modem será <devicename>/dev/cuaa1</devicename>.</para>
    </sect2>

    <sect2>
      <title>Conectando Manualmente</title>

	<para>Conectar a Internet através do controle manual do
	  <command>ppp</command> é rápido, fácil e uma boa forma
	  de depurar uma conexão ou apenas ver como seu provedor
	  gerencia conexões de clientes ppp.  Vamos iniciar
	  o <application>PPP</application> pela linha de comando.
	  Note que todos os nossos exemplos irão utilizar
	  <emphasis>exemplo</emphasis> como o hostname da máquina
	  rodando o <application>PPP</application>.  Você inicia
	  o <command>ppp</command> digitando apenas
	  <command>ppp</command>:</para>

      <screen>&prompt.root; <userinput>ppp</userinput></screen>

      <para>Nós iniciamos o <command>ppp</command>.</para>

      <screen>ppp ON exemplo&gt; <userinput>set device <devicename>/dev/cuaa1</devicename></userinput></screen>

	<para>Ajustamos o dispositivo do modem, nesse caso
	  <devicename>cuaa1</devicename>.</para>

      <screen>ppp ON exemplo&gt; <userinput>set speed 115200</userinput></screen>

	<para>Ajusta a velocidade de conexão, nesse caso estamos
	  utilizando 115,200 <acronym>kbps</acronym>.</para>

      <screen>ppp ON exemplo&gt; <userinput>enable dns</userinput></screen>

	<para>Dizemos ao <command>ppp</command> que configure
	  nosso <literal>resolver</literal> e adicione as linhas
	  <literal>nameserver</literal> ao <filename>/etc/resolv.conf</filename>.
	  Se o <command>ppp</command> não puder determinar seu
	  <literal>hostname</literal> nós podemos ajustá-lo manualmente
	  mais tarde.</para>

      <screen>ppp ON exemplo&gt; <userinput>term</userinput></screen>

	<para>Mude para o modo <quote>terminal</quote> para que possamos
	controlar o modem manualmente.</para>

      <programlisting>deflink: Entering terminal mode on <devicename>/dev/cuaa1</devicename>
type '~h' for help</programlisting>

      <screen><userinput>at</userinput>
	OK
	<userinput>atdt<replaceable>123456789</replaceable></userinput></screen>

	<para>Utilize <command>at</command> para inicializar o modem,
	  e então <command>atdt</command> e o número do seu provedor
	  para iniciar o processo de discagem.</para>

      <screen>CONNECT</screen>

	<para>Sinal de confirmação da conexão.  Se nós formos ter
	  qualquer problema, não relacionado ao hardware, é aqui que
	  tentaremos resolvê-lo.</para>

      <screen>ISP Login:<userinput>usuário</userinput></screen>

	<para>Aqui um usuário é requerido.  Digite o usuário que
	  lhe foi informado pelo provedor.</para>

      <screen>ISP Pass:<userinput>senha</userinput></screen>

	<para>Agora é a vez da senha, apenas responda com a senha
	  que o provedor lhe informou.  Da mesma maneira como
	  entramos no sistema, a senha não será mostrada aqui.</para>

      <screen>Shell or PPP:<userinput>ppp</userinput></screen>

	<para>Dependendo do seu provedor este prompt pode não
	  aparecer.  Aqui estamos sendo indagados se nós gostaríamos
	  de usar uma <literal>shell</literal> no provedor ou iniciar
	  o <command>ppp</command>.  Neste exemplo nós escolhemos
	  <command>ppp</command> pois queremos uma conexão com a
	  Internet.</para>

      <screen>Ppp ON exemplo&gt;</screen>

	<para>Note que neste exemplo o primeiro <option>p</option>
	  está maiúsculo agora.  Isso mostra que nós nos conectamos
	  com sucesso ao provedor.</para>

      <screen>PPp ON exemplo&gt;</screen>

	<para>Nós nos autenticamos com sucesso junto ao provedor
	  e estamos esperando o endereço IP que vai ser fornecido.</para>

      <screen>PPP ON exemplo&gt;</screen>

	<para>Nós fizemos um acordo sobre o endereço IP e completamos
	  com sucesso nossa conexão.</para>

      <screen>PPP ON exemplo&gt;<userinput>add default HISADDR</userinput></screen>

	<para>Aqui nós adicionar a rota padrão.  Precisamos fazer isso
	  antes de conversar com o mundo exterior pois no momento
	  a única conexão estabelecida é com a ponta remota.  Se
	  isso falhar devido a já haver uma rota existente você
	  pode colocar o caractere <literal>!</literal> na frente
	  da opção <option>add</option>.  Você também pode fazer isso
	  antes de iniciar a conexão e o programa irá negociar uma rota
	  de acordo.</para>

	<para>Se tudo correu bem nós devemos ter uma conexão ativa
	  com a Internet agora, que deve ser jogada para o segundo
	  plano usando <keycombo action="simul"><keycap>CTRL</keycap>
	  <keycap>z</keycap></keycombo> Se você notar que o
	  <command>PPP</command> retornou para <command>ppp</command>
	  então nós perdemos nossa conexão.  É bom saber isso pois
	  ele lhe informa o estado atual da conexão.  P's maiúsculos
	  indicam que nós temos uma conexão com o provedor e p's
	  minúsculos indicam que a conexão foi perdido por um
	  motivo qualquer.  O comando <command>ppp</command> tem
	  apenas dois estados.</para>

      <sect3>
	<title>Depuração</title>

	<para>Se você tem uma linha direta e não consegue realizar
	  a conexão tente desativar controle de fluxo por hardware
	  <acronym>CTS/RTS</acronym> com a opção <option>set ctsrts
	  off</option>.  Isso pode ocorrer caso você esteja conectado
	  a um servidor PPP onde o <application>PPP</application>
	  trava quando ele tenta enviar os dados pelo seu <literal>
	  link</literal> de comunicação.  Ele estaria esperando
	  por um sinal <acronym>CTS</acronym>, ou Clear To Send (Livre
	  para Enviar), que pode nunca chegar.  Entretanto se você
	  ativar esta opção você deve também usar <option>set accmap</option>
	  que pode ser requerido para cancelar o hardware que
	  depende do envio de certos caracteres de ponta a ponta, na
	  maior parte do tempo XON/XOFF.  Veja a página manual
	  &man.ppp.8; para maiores informações sobre esta opção
	  e como ela é utilizada.</para>

	<para>Se você tem um modem antigo pode ter que utilizar
	  a opção <option>set parity even</option>.  Paridade é
	  ajustada para <literal>none</literal> por padrão, mas
	  é utilizada para verificação de erros (com um aumento
	  no tráfego) em modens antigos e alguns provedores.  Você
	  pode precisar desta opção no provedor Compuserve.</para>

	<para>O <application>PPP</application> pode não retornar
	  para o modo de comando, o que geralmente indica um erro
	  de negociação onde o provedor está aguardando que você
	  inicie a negociação.  Nesse ponto, usar o comando
	  <command>~p</command> irá forçar o ppp a enviar as
	  informações de configuração.</para>

	<para>Se você nunca ver um prompt de login você terá de
	  utilizar <acronym>PAP</acronym> ou <acronym>CHAP</acronym>
	  para fazer a autenticação em vez do estilo &unix; no
	  exemplo acima.  Para usar <acronym>PAP</acronym> ou
	  <acronym>CHAP</acronym> apenas adicione as seguintes
	  opções no <application>PPP</application> antes de
	  entrar em modo terminal:</para>

	<screen>ppp ON exemplo&gt; <userinput>set authname <replaceable>usuario</replaceable></userinput></screen>

	<para>Onde <replaceable>usuario</replaceable> deve ser trocado
	  pelo usuário que foi definido pelo seu provedor.</para>

	<screen>ppp ON exemplo&gt; <userinput>set authkey <replaceable>senha</replaceable></userinput></screen>

	<para>Onde <replaceable>senha</replaceable> deve ser trocado
	  pela senha que foi definida pelo seu provedor.</para>

	<para>Se você conectar sem problemas mas não conseguir achar
	  nenhum domínio, tente utilizar o &man.ping.8; com um
	  endereço <acronym>IP</acronym> e ver se você consegue
	  alguma informação.  Se sua ver 100% de perda de pacotes
	  (<literal>packet</literal> <literal>loss</literal>) então
	  poderá indicar que uma rota padrão não foi definida.  Verifique
	  novamente que a opção <option>add default HISADDR</option>
	  foi definida durante a conexão.  Se você conseguir conectar
	  a um endereço IP remoto então é possível que um servidor
	  de nomes não foi adicionado ao <filename>/etc/resolv.conf</filename>.
	  Esse arquivo deve se parecer com:</para>

	<programlisting>domain <replaceable>exemplo.com.br</replaceable>
nameserver <replaceable>x.x.x.x</replaceable>
nameserver <replaceable>y.y.y.y</replaceable></programlisting>

	<para>Onde <replaceable>x.x.x.x</replaceable> e
	  <replaceable>y.y.y.y</replaceable> devem ser trocados
	  pelos endereços IP dos servidores de DNS do seu provedor.
	  Essa informação pode ser definida pelo seu provedor, ou não.
	  Ligue para seu provedor e peça que lhe informem estes endereços.</para>

	<para>Você pode fazer com que o &man.syslog.3; ative a função
	  de <literal>logging</literal> para sua conexão <application>PPP</application></para>
	
	<programlisting>!ppp
*.*     /var/log/ppp.log</programlisting>

	<para>no <filename>/etc/syslog.conf</filename>.  Na maioria dos casos
	  esta funcionalidade já existe.</para>

      </sect3>
    </sect2>
  </sect1>




  <sect1 id="pppoe">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Jim</firstname>
	  <surname>Mock</surname>
	  <contrib>Contribuído (from http://node.to/freebsd/how-tos/how-to-freebsd-pppoe.html) por </contrib>
	</author>
      </authorgroup>
      <!-- 10 Jan 2000 -->
    </sect1info>

    <title>Usando PPP sobre Ethernet (PPPoE)</title>
    <indexterm><primary>PPP</primary><secondary>over Ethernet</secondary></indexterm>
    <indexterm>
      <primary>PPPoE</primary>
      <see>PPP, over Ethernet</see>
    </indexterm>

	<para>Esta seção descreve como configurar o PPP sobre Ethernet
      (<acronym>PPPoE</acronym>).</para>

    <sect2>
      <title>Configurando o Kernel</title>

	<para>Não é necessária nenhuma configuração no kernel para o PPPoE.  Se
	  o suporte a netgraph não estiver compilado no kernel ele será
	  carregado dinamicamente pelo <application>ppp</application>.</para>
    </sect2>

    <sect2>
    	<title>Ajustando o <filename>ppp.conf</filename></title>

	<para>Abaixo temos um exemplo de um <filename>ppp.conf</filename>
	  funcional:</para>

      <programlisting>default:
  set log Phase tun command # você pode adicionar mais logging se quiser
  set ifaddr 10.0.0.1/0 10.0.0.2/0

nome_do_provedor:
  set device PPPoE:<replaceable>xl1</replaceable> # troque xl1 pelo seu dispositivo ethernet
  set authname usuario
  set authkey senha
  set dial
  set login
  add default HISADDR</programlisting>

    </sect2>

    <sect2>
      <title>Executando o <application>ppp</application></title>

	<para>Como <username>root</username>, você pode executar:</para>

      <screen>&prompt.root; <userinput>ppp -ddial nome_do_provedor</userinput></screen>

    </sect2>

    <sect2>
      <title>Iniciando o <application>ppp</application> na Inicialização</title>

	<para>Adicione o seguinte ao seu arquivo <filename>/etc/rc.conf</filename>:</para>

      <programlisting>ppp_enable="YES"
ppp_mode="ddial"
ppp_nat="YES"	# se você quer habilitar NAT para sua rede, ou não.
ppp_profile="nome_do_provedor"</programlisting>
    </sect2>

    <sect2>
      <title>Usando uma Service Tag no PPPoE</title>

	<para>Algumas vezes será necessário usar uma <literal>service</literal>
	  <literal>tag</literal> para estabelecer sua conexão.  Service tags são
	  usadas para distinguir entre diferentes serviços de PPPoE em uma
	  dada rede.</para>

	<para>Você deve ter recebido qualquer informação que é requerida
	  do seu provedor para service tags.  Se você não tiver, pergunte
	  a equipe técnica do seu provedor.</para>

	<para>Como uma último recurso você pode tentar o método sugerido
	  pelo programa <ulink url="http://www.roaringpenguin.com/pppoe/">Roaring Penguin
	  PPPoE</ulink> que pode ser localizado na coleção de <link
	  linkend="ports">ports</link>.  Tenha em mente que isso pode desprogramar
	  seu modem e deixá-lo inutilizável.  Portanto pense duas vezes antes de
	  fazer isto.  Simplesmente instale o programa fornecido com seu
	  modem pelo provedor.  Então acesse o menu <guimenu>System</guimenu>
	  pelo programa.  O nome do seu perfil deve estar listado.  Ele geralmente é <emphasis>provedor</emphasis>.</para>

	<para>O perfil (service tag) será utilizado na configuração
	  do PPPoE no<filename>ppp.conf</filename> como a parte do
	  provedor no comando <command>set device</command> (veja
	  &man.ppp.8; para maiores detalhes).  Ele deve se parecer
	  com:</para>

      <programlisting>set device PPPoE:<replaceable>xl1</replaceable>:<replaceable>ISP</replaceable></programlisting>

	<para>Não esqueça de mudar <replaceable>xl1</replaceable>
	  pelo dispositivo correto para sua placa de rede Ethernet.</para>

	<para>Não esqueça de trocar <replaceable>provedor</replaceable>
	  pelo perfil que você acabou de achar.</para>

	<para>Para mais informações veja:</para>

      <itemizedlist>
	<listitem>
	  <para><ulink
	    url="http://renaud.waldura.com/doc/freebsd/pppoe/">Cheaper
	    Broadband with FreeBSD on DSL</ulink> by Renaud
	    Waldura.</para>
	</listitem>

	<listitem>
	  <para><ulink
	      url="http://www.ruhr.de/home/nathan/FreeBSD/tdsl-freebsd.html">
	      Nutzung von T-DSL und T-Online mit FreeBSD</ulink>
	    by Udo Erdelhoff (in German).</para>
	</listitem>
      </itemizedlist>
    </sect2>

    <sect2 id="ppp-3com">

      <title>PPPoE com um &tm.3com; <trademark class="registered">HomeConnect</trademark> ADSL Modem Dual Link</title>

	<para>Este modem não segue o <ulink
	  url="http://www.faqs.org/rfcs/rfc2516.html">RFC 2516</ulink>
	(<emphasis>A Method for transmitting PPP over Ethernet
	(PPPoE)</emphasis>, escrito por L.  Mamakos, K.  Lidl, J.  Evarts,
	D.  Carrel, D.  Simone, and R.  Wheeler).  Em vez disso, códigos
	diferentes para os pacotes são utilizados em vez de quadros Ethernet.
	Por favor reclame com a <ulink url="http://www.3com.com/">3Com</ulink>
	se você acha que ele deveria seguir a especificação PPPoE.</para>

	<para>Para que o FreeBSD seja capaz de se comunicar com este
	  dispositivo uma sysctl precisa ser ajustada.  Isso pode ser
	  feito automaticamente na inicialização do sistema através
	  da atualização do arquivo de configuração <filename>/etc/sysctl.conf</filename>:</para>

	<programlisting>net.graph.nonstandard_pppoe=1</programlisting>

	<para>ou pode ser utilizado o comando
	  <command>sysctl net.graph.nonstandard_pppoe=1</command> para
	  um efeito imediato.</para>

	<para>Infelizmente essa modificação tem efeito no sistema inteiro e
	  não é possível conversar com um servidor PPPoE normal e com um
	  &tm.3com; <trademark class="registered">HomeConnect</trademark> ADSL Modem
	  ao mesmo tempo.</para>

    </sect2>
  </sect1>

  <sect1 id="pppoa">
    <title>Usando <application>PPP</application> sobre ATM (PPPoA)</title>
    <indexterm><primary>PPP</primary><secondary>over ATM</secondary></indexterm>
    <indexterm>
      <primary>PPPoA</primary>
      <see>PPP, over ATM</see>
    </indexterm>

	<para>O seguinte descreve como ajustar o PPP sobre ATM (PPPoA).
	  PPPoA é uma escolha popular entre provedor de DSL da Europa.</para>

    <sect2>
      <title>Usando PPPoA com o Alcatel &speedtouch; USB</title>

	<para>Suporte PPPoA para este dispositivo é fornecido como
	  um port no FreeBSD pois o <literal>firmware</literal> é
	  fornecido através de um <ulink url="http://www.speedtouchdsl.com/disclaimer_lx.htm">
	  acordo de licenciamento</ulink> com a
	  Alcatel e não pode ser distribuído livremente com o
	  sistema base do FreeBSD.</para>

	<para>Para instalar o programa simplesmente use a coleção
	  de <link linkend="ports">ports</link>.  Instale o port
	  <filename role="package">net/pppoa</filename> e
	  siga as instruções fornecidas.</para>

	<para>Como muitos dispositivos USB, o Alcatel &speedtouch; USB
	  precisa fazer o download do firmware do computador para operar
	  de acordo. É possível automatizar este processo no &os; de modo
	  que essa transferência aconteça no momento que o dispositivo
	  foi ligado na porta USB.  A seguinte informação pode ser adicionada
	  ao arquivo <filename>/etc/usbd.conf</filename> para ativar
	  essa transferência automática.  O arquivo precisar ser
	  editado como o usuário <username>root</username>.</para>

      <programlisting>device "Alcatel SpeedTouch USB"
    devname "ugen[0-9]+"
    vendor 0x06b9
    product 0x4061
    attach "/usr/local/sbin/modem_run -f /usr/local/libdata/mgmt.o"</programlisting>

	<para>Para ativar o daemon USB, <application>usbd</application>,
	  coloque a seguinte linha no <filename>/etc/rc.conf</filename>:</para>

     <programlisting>usbd_enable="YES"</programlisting>

	<para>Também é possível ajustar o <application>ppp</application>
	  para discar na inicialização do sistema.  Para fazer isso adicione
	  as seguintes linhas no <filename>/etc/rc.conf</filename>.  De novo,
	  para realizar este procedimento você deverá estar <literal>logado</literal>
	  como <username>root</username>.</para>

     <programlisting>ppp_enable="YES"
ppp_mode="ddial"
ppp_profile="adsl"</programlisting>

	<para>Para que isto funcione corretamente você terá de usar
	  <filename>ppp.conf</filename> de exemplo fornecido com o
	  port <filename role="package">net/pppoa</filename>.</para>

    </sect2>

    <sect2>
      <title>Usando o mpd</title>

	<para>Você pode usar o <application>mpd</application> para se
	  conectar a uma variedade de serviços, em particular serviços
	  PPTP.  Você pode achar o <application>mpd</application> na
	  coleção de ports, <filename role="package">net/mpd</filename>.
	  Muitos modems ADSL requerem a criação de um túnel PPTP entre
	  o modem e o computador.  Um desses modems é o Alcatel &speedtouch;
	  Home.</para>

	<para>Primeiro você precisar instalar o port e então você
	  pode configurar o <application>mpd</application> para
	  os seus requerimentos e as definições do provedor.  O
	  port põe um conjunto de arquivos de configuração de
	  exemplo, que são bem documentados, em
	  <filename><replaceable>PREFIX</replaceable>/etc/mpd/</filename>.
	  Note que <replaceable>PREFIX</replaceable> significa
	  o diretório em que seus ports são instalados.  O padrão
	  é <filename>/usr/local</filename>.  Um guia completo de
	  como configurar o <application>mpd</application> em
	  HTML fica disponível assim que o port for instalado.
	  Ele é colocado em
	  <filename><replaceable>PREFIX</replaceable>/share/mpd/</filename>.
	  Aqui vai um exemplo de configuração para se conectar a
	  um serviço ADSL com o <application>mpd</application>.  A
	  configuração esta espalhada por dois arquivos.  Primeiro
	  o <filename>mpd.conf</filename>:</para>

      <programlisting>default:
    load adsl

adsl:
    new -i ng0 adsl adsl
    set bundle authname <replaceable>usuario</replaceable> <co
    id="co-mpd-ex-user">
    set bundle password <replaceable>senha</replaceable> <co
    id="co-mpd-ex-pass">
    set bundle disable multilink

    set link no pap acfcomp protocomp
    set link disable chap
    set link accept chap
    set link keep-alive 30 10

    set ipcp no vjcomp
    set ipcp ranges 0.0.0.0/0 0.0.0.0/0

    set iface route default
    set iface disable on-demand
    set iface enable proxy-arp
    set iface idle 0

    open</programlisting>

    <calloutlist>
      <callout arearefs="co-mpd-ex-user">
	<para>O usuário usado para se autenticar com seu provedor.</para>
      </callout>
      <callout arearefs="co-mpd-ex-pass">
	<para>A senha usada para se autenticar com seu provedor.</para>
      </callout>
    </calloutlist>

	<para>O arquivo <filename>mpd.links</filename> contém informações
	  sobre o link, ou links, que você deseja estabelecer.  Um exemplo
	  para acompanhar o exemplo acima é dado abaixo:</para>

    <programlisting>adsl:
    set link type pptp
    set pptp mode active
    set pptp enable originate incoming outcall
    set pptp self <replaceable>10.0.0.1</replaceable> <co
    id="co-mpd-ex-self">
    set pptp peer <replaceable>10.0.0.138</replaceable> <co
    id="co-mpd-ex-peer"></programlisting>

    <calloutlist>
      <callout arearefs="co-mpd-ex-self">
	<para>O endereço IP do computador que está rodando o mpd.</para>
      </callout>
      <callout arearefs="co-mpd-ex-peer">
      	<para>O endereço IP do seu modem ADSL.  Para o Alcatel
	  &speedtouch; Home o padrão é <hostid role="ipaddr">
	  10.0.0.138</hostid>.</para>
      </callout>
    </calloutlist>

	<para>É possível iniciar a conexão simplesmente executando
	  o seguinte comando como <username>root</username>:</para>

    <screen>&prompt.root; <userinput>mpd -b <replaceable>adsl</replaceable></userinput></screen>

	<para>Você pode ver o status da conexão com o seguinte
	  comando:</para>

    <screen>&prompt.user; <userinput>ifconfig <replaceable>ng0</replaceable></userinput>
ng0: flags=88d1&lt;UP,POINTOPOINT,RUNNING,NOARP,SIMPLEX,MULTICAST&gt; mtu 1500
     inet 216.136.204.117 --> 204.152.186.171 netmask 0xffffffff</screen>

	<para>Usar o <application>mpd</application> é a maneira
	  recomendada de se conectar ao serviço de ADSL com o &os;.</para>

    </sect2>

    <sect2>
      <title>Usando o pptpclient</title>
	
	<para>É também possível usar o FreeBSD para se conectar a
	  outros serviços de ADSL usando o
	  <filename role="package">net/pptpclient</filename>.</para>
	
	<para>Para usar o <filename role="package">net/pptpclient</filename>
	  para se conectar ao serviço ADSL, instale o port ou pacote
	  e edite o arquivo <filename>/etc/ppp/ppp.conf</filename>.  Você
	  precisará estar como <username>root</username> para realizar
	  estas duas operações.  Uma seção de exemplo do
	  <filename>ppp.conf</filename> é dada abaixo.  Para maiores
	  informações sobre as opções do <filename>ppp.conf</filename>
	  consulte a página manual, &man.ppp.8;.</para>

      <programlisting>adsl:
 set log phase chat lcp ipcp ccp tun command
 set timeout 0
 enable dns
 set authname <replaceable>usuario</replaceable> <co id="co-pptp-ex-user">
 set authkey <replaceable>senha</replaceable> <co id="co-pptp-ex-pass">
 set ifaddr 0 0
 add default HISADDR</programlisting>

   <calloutlist>
     <callout arearefs="co-pptp-ex-user">
	   <para>O usuario usado para se autenticar com seu provedor.</para>
	 </callout>
	 <callout arearefs="co-pptp-ex-pass">
	   <para>A senha usada para sua conta.</para>
	 </callout>
   </calloutlist>

   <warning>
   	<para>Como você precisar por a senha da sua conta no
	  <filename>ppp.conf</filename> em texto puro você
	  deve ter certeza de que nínguem conseguirá ler o
	  conteúdo deste arquivo.  A seguinte série de comandos
	  irá fazer com que o arquivo seja apenas lido pelo
	  <username>root</username>.  Veja as páginas manuais
	  do &man.chmod.1; e &man.chown.8; para mais informações.</para>

	 <screen>&prompt.root; <userinput>chown root:wheel /etc/ppp/ppp.conf</userinput>
&prompt.root; <userinput>chmod 600 /etc/ppp/ppp.conf</userinput></screen>
   </warning>

	<para>Isso irá abrir um túnel para uma sessão PPP com seu
	roteador DSL.  Modems ADSL com interfaces Ethernet possuem um
	endereço de IP local ao qual você pode se conectar.  No
	caso do Alcatel &speedtouch; Home este endereço é o
	<hostid role="ipaddr">10.0.0.138</hostid>.  A documentação
	do seu roteador deve lhe dizer qual endereço o dispositivo
	utiliza.  Abra um túnel e inicie uma sessão PPP com o seguinte
	comando:</para>

      <screen>&prompt.root; <userinput>pptp <replaceable>endereço</replaceable> <replaceable>adsl</replaceable></userinput></screen>

      <tip>
      	<para>Você pode querer adicionar um "E" comercial (<quote>&amp;</quote>)
	  ao final do comando anterior pois o <application>pptp</application>
	  não irá retornar o prompt se você não fizer isso.</para>
      </tip>
	
	<para>Um túnel virtual <devicename>tun</devicename> será criado
	  para a interação entre o <application>pptp</application> e o
	  <application>ppp</application>.  Uma vez que o prompt tiver
	  retornado, ou que o processo <application>pptp</application>
	  confirmou a conexão, você pode examinar o túnel da seguinte
	  forma:</para>

      <screen>&prompt.user; <userinput>ifconfig <replaceable>tun0</replaceable></userinput>
tun0: flags=8051&lt;UP,POINTOPOINT,RUNNING,MULTICAST&gt; mtu 1500
	inet 216.136.204.21 --> 204.152.186.171 netmask 0xffffff00
	Opened by PID 918</screen>

	<para>Se não foi possível conectar, verifica a configuração
	  do roteador, que geralmente é acessível através de
	  <application>telnet</application> ou com um navegador.
	  Se você ainda não puder se conectar examine a saída do
	  comando <command>pptp</command> e o conteúdo do
	  arquivo de log do <application>ppp</application> em
	  <filename>/var/log/ppp.log</filename> para encontrar
	  algumas pistas.</para>
    </sect2>
  </sect1>

  <sect1 id="slip">
    <sect1info>
      <authorgroup>
	<author>
	  <firstname>Satoshi</firstname>
	  <surname>Asami</surname>
	  <contrib>Originalmente contribuído por </contrib>
	</author>
      </authorgroup>
      <authorgroup>
	<author>
	  <firstname>Guy</firstname>
	  <surname>Helmer</surname>
	  <contrib>Com adições de </contrib>
	</author>
	<author>
	  <firstname>Piero</firstname>
	  <surname>Serini</surname>
	</author>
      </authorgroup>
    </sect1info>

    <title>Usando SLIP</title>
    <indexterm><primary>SLIP</primary></indexterm>

    <sect2 id="slipc">
      <title>Ajustando um cliente SLIP</title>
      <indexterm><primary>SLIP</primary><secondary>client</secondary></indexterm>
      <para>Mostraremos uma maneira de ajustar uma máquina FreeBSD para
        SLIP numa rede de endereços estáticos. Para ajuste dinâmico de
	endereços (seu endereço IP muda cada vez que se conecta) uma
	configuração mais complexa deve ser feita.</para>

	<para>Primeiro determine em qual porta serial seu modem está
	  conectado. Muitas pessoas ajustam um link simbólico,
	  <devicename>/dev/modem</devicename>, que aponta para o
	  nome real do dispositivo, <devicename>/dev/cuaaN</devicename>.
	  Isso permite que você abstraia o nome do dispositivo caso
	  você precise mover o modem para outra porta. Isso pode ser
	  bastante útil quando você precisa arrumar um monte
	  de arquivos no <filename>/etc</filename> e arquivos
	  <filename>.kermrc</filename> por todo o sistema!</para>

      <note>
	<para><filename>/dev/cuaa0</filename> é
	  <devicename>COM1</devicename>, <filename>cuaa1</filename> é
	  <devicename>COM2</devicename>, etc.</para>
      </note>

	<para>Tenha certeza de ter o seguinte na configuração do
	  seu kernel:</para>

      <programlisting>pseudo-device   sl      1</programlisting>

	<para>Isso é incluído no kernel <filename>GENERIC</filename>, 
	  portanto não deve ser um problema a menos que você removeu-o.</para>

      <sect3>
	<title>Coisas Que Você Tem De Fazer Apenas Uma Vez</title>

	<procedure>
	  <step>
	  <para>Adicione sua máquina, gateway e servidores de nomes
	    ao arquivo <filename>/etc/hosts</filename>. O meu se
	    parece com isso:</para>

	    <programlisting>127.0.0.1	       localhost loghost
136.152.64.181	  water.CS.Example.EDU water.CS water
136.152.64.1	    inr-3.CS.Example.EDU inr-3 slip-gateway
128.32.136.9	    ns1.Example.EDU ns1
128.32.136.12	   ns2.Example.EDU ns2</programlisting>
	  </step>

	  <step>
	  <para>Tenha certeza de que você tem <option>hosts</option>
	    antes de <option>bind</option> no seu 
	    <filename>/etc/host.conf</filename> em versões do FreeBSD
	    anteriores a 5.0.  Desde o FreeBSD&nbsp;5.0, o sistema
	    usa o arquivo <filename>/etc/nsswitch.conf</filename>
	    portanto tenha certeza de ter <option>files</option>
	    antes de <option>dns</option> na linha <option>hosts</option> 
	    deste arquivo.  Sem estes parâmetros coisas estranhas
	    podem acontecer.</para>
	  </step>

	  <step>
	  <para>Edite o arquivo <filename>/etc/rc.conf</filename>.</para>

	    <orderedlist>
	      <listitem>
		<para>Define seu <literal>hostname</literal> editando a
		  linha que diz:</para>
	
		<programlisting>hostname="meunome.my.dominio"</programlisting>

		<para>O hostname completo da sua máquina deve ser posto
		  lá.</para>
	      </listitem>

	      <listitem>
	      	<para>Adicione <devicename>sl0</devicename> a listagem
		  de interfaces de rede editando a linha que diz:</para>

		<programlisting>network_interfaces="lo0"</programlisting>

		<para>to:</para>

		<programlisting>network_interfaces="lo0 sl0"</programlisting>
	      </listitem>

	      <listitem>
	      	<para>Define algumas opções de inicialização da
		  <devicename>sl0</devicename> editando a linha:</para>

		<programlisting>ifconfig_sl0="inet ${hostname} slip-gateway netmask 0xffffff00 up"</programlisting>
	      </listitem>

	      <indexterm><primary>default route</primary></indexterm>
	      <listitem>
		<para>Define o roteador padrão editando a linha:</para>

		<programlisting>defaultrouter="NO"</programlisting>

		<para>to:</para>

		<programlisting>defaultrouter="slip-gateway"</programlisting>
	      </listitem>
	    </orderedlist>
	  </step>

	  <step>
	    <para>Crie um arquivo <filename>/etc/resolv.conf</filename> que
	      contenha:</para>

	    <programlisting>domain CS.Exemplo.BR
nameserver 128.32.136.9
nameserver 128.32.136.12</programlisting>

	    <indexterm><primary>nameserver</primary></indexterm>
	    <indexterm><primary>domain name</primary></indexterm>
	    <para>Como você pode ver, estas opções definem os servidores
	      de nomes. É claro que o nome do domínio e o endereços dos
	      servidores dependem do seu ambiente.</para>
	  </step>

	  <step>
	  <para>Ajuste uma senha para <username>root</username> e
	    <username>toor</username> (e qualquer outra conta que
	    não tenha uma senha).</para>
	  </step>

	  <step>
	  <para>Reinicie sua máquina e tenha certeza de que ela
	    iniciou com o <literal>hostname</literal> correto.</para>
	  </step>
	</procedure>
      </sect3>

      <sect3>
	<title>Criando uma Conexão SLIP</title>
	<indexterm><primary>SLIP</primary><secondary>connecting with</secondary></indexterm>
	<procedure>
	  <step>
	    <para>Discar, digitar <command>slip</command> no prompt,
	      digitar o nome da sua máquina e a senha. O que é 
	      necessário para estabelecer a conexão varia de acordo
	      com seu ambiente. Se você usa kermit, pode tentar
	      um script como o abaixo:</para>

	    <programlisting># kermit setup
set modem hayes
set line /dev/modem
set speed 115200
set parity none
set flow rts/cts
set terminal bytesize 8
set file type binary
# A próxima macro vai discar e logar
define slip dial 643-9600, input 10 =&gt;, if failure stop, -
output slip\x0d, input 10 Username:, if failure stop, -
output silvia\x0d, input 10 Password:, if failure stop, -
output ***\x0d, echo \x0aCONNECTED\x0a</programlisting>

	<para>É claro que você precisar trocar o hostname e a senha.
	  Depois de fazer isso você pode digitar <command>slip</command>
	  do prompt do kermit para se conectar.</para>

	    <note>
	      <para>Deixar sua senha em texto puro no sistema de arquivos
	        geralmente é uma <emphasis>má</emphasis> idéia.</para>
	    </note>
	  </step>

	  <step>
	    <para>Deixe o kermit lá (você pode suspendê-lo com um
                   <keycombo>
                   <keycap>Ctrl</keycap>
                   <keycap>z</keycap>
	      </keycombo>) e, como <username>root</username>, digite:</para>

	    <screen>&prompt.root; <userinput>slattach -h -c -s 115200 /dev/modem</userinput></screen>

	<para>Se você conseguir <literal>pingar</literal> alguma máquina
	  no outro lado do roteador, você está conectado! Se isso não
	  funcionar você pode tentar usar a opção <option>-a</option>
	  em vez de <option>-c</option> como um argumento para
	  <command>slattach</command>.</para>
	  </step>
	</procedure>
      </sect3>

      <sect3>
	<title>Como Desligar uma Conexão</title>

	<para>Faça o seguinte:</para>

	<screen>&prompt.root; <userinput>kill -INT `cat /var/run/slattach.modem.pid`</userinput></screen>

	<para>para matar o <command>slattach</command>.  Tenha em mente
	 que você precisar ser <username>root</username> para realizar 
	 esta operação.  Volte para o kermit (através da execução do
	 comando <command>fg</command> se você suspendeu ele) e saia
	 dele (com o comando <command>q</command>).</para>


	<para>O página manual do <command>slattach</command> diz que você
	  tem de usar <command>ifconfig sl0 down</command> para marcar
	  a interface como desligada, mas isso não parece fazer nenhuma
	  diferença para mim. (<command>ifconfig sl0</command> diz
	  a mesma coisa.)</para>

	<para>Algumas vezes, seu modem pode se recusar a liberar
	  a linha (o meu faz isso as vezes).  Nesse caso, simplesmente
	  inicie o kermit e saia novamente.  Ele geralmente libera
	  a linha na segunda tentativa.</para>
      </sect3>

      <sect3>
	<title>Resolução de Problemas</title>

	<para>Se isso não funcionar, sinta-se livre para me perguntar.  As
	  coisas que as pessoas têm feito até agora:</para>

	<itemizedlist>
	  <listitem>
	    <para>Não usar <option>-c</option> ou <option>-a</option> no
	      <command>slattach</command> (Isso não deve ser fatal,
	      mas alguns usuários tem informado que isso resolve
	      os problemas deles).</para>
	  </listitem>

	  <listitem>
	    <para>Usar <option>s10</option> em vez de <option>sl0</option>
	    (pode ser difícil de ver a diferença em algumas fontes).</para>
	  </listitem>

	  <listitem>
	    <para>Tente <command>ifconfig sl0</command> para ver
	      o status da sua interface.  Por exemplo, você pode
	      ver:</para>

	    <screen>&prompt.root; <userinput>ifconfig sl0</userinput>
sl0: flags=10&lt;POINTOPOINT&gt;
	inet 136.152.64.181 --&gt; 136.152.64.1 netmask ffffff00</screen>
	  </listitem>

	  <listitem>
	    <para>Se você ver  <errorname>no route to host</errorname>
	      do ping, pode haver um problema com sua tabela de roteamento.
	      Você pode usar o comando <command>netstat -r</command> para
	      mostra as rotas correntes:</para>

	    <screen>&prompt.root; <userinput>netstat -r</userinput>
Routing tables
Destination      Gateway	    Flags     Refs     Use IfaceMTU    Rtt    Netmasks:

(root node)
(root node)

Route Tree for Protocol Family inet:
(root node) =&gt;
default	  inr-3.Example.EDU UG	  8   224515 sl0 -      -
localhost.Exampl localhost.Example.  UH	  5    42127 lo0 -       0.438
inr-3.Example.ED water.CS.Example.E UH	  1	0 sl0 -      -
water.CS.Example localhost.Example.  UGH	34 47641234 lo0 -       0.438
(root node)</screen>

	  <para>Os exemplos anteriores são de um sistema relativamente
	    carregado. Os números no seu sistema vão variar dependendo
	    da atividade de rede.</para>

	  </listitem>
	</itemizedlist>
      </sect3>
    </sect2>

    <sect2 id="slips">
      <title>Configurando um Servidor SLIP</title>
      <indexterm><primary>SLIP</primary><secondary>server</secondary></indexterm>

	<para>Esse documento fornece sugestões para se ajustar um
	 servidor SLIP em um sistema FreeBSD, o que tipicamente significa
	 configurar o sistema para que inicie as conexões automaticamente
	 assim que ocorrer o login de clientes remotos.</para>

      <!-- Disclaimer is not necessarily relevant
      <para>The author has written this document based
	on his experience; however, as your system and needs may be
	different, this document may not answer all of your questions, and
	the author cannot be responsible if you damage your system or lose
	data due to attempting to follow the suggestions here.</para>
      -->

      <sect3 id="slips-prereqs">
	<title>Pré-requisitos</title>
	<indexterm><primary>TCP/IP networking</primary></indexterm>
	<para>Essa seção é bastante técnica em sua natureza, portanto
	  conhecimento sobre o assunto é requerido.  Assumimos que você
	  esteja familiar com a suíte de protocolos TCP/IP, e em
	  particular, endereçamento, máscaras de rede, <literal>subnetting</literal>,
	  roteamento e protocolos de roteamento, como o RIP.  Configurar
	  serviços SLIP em um servidor de acesso discado requer conhecimento
	  de todos esses conceitos, e se você não está familiar com eles,
	  por favor leia o livro <emphasis>TCP/IP Network Administration</emphasis>
	  de Craig Hunt publicado pela O'Reilly &amp; Associates, Inc. (
	  ISBN 0-937175-82-X), ou os livros de Douglas Comer sobre TCP/IP.</para>

	<indexterm><primary>modem</primary></indexterm>
	<para>É assumido que você já ajustou seu modem(s) e 
	 configurou os arquivos do sistema apropriados para permitir
	 logins através de seus modems.  Se você não preparou o
	 sistema ainda para isso, por favor veja o tutorial sobre
	 como configurar serviços de acesso discado; se você tem
	 um navegador disponível, navegue pela lista de tutoriais 
	 disponíveis em <ulink url="../../../../index.html">http://www.FreeBSD.org/</ulink>.
	 Você também pode verificar as páginas manuais &man.sio.4; para
	 informações sobre o driver de dispositivo para portas seriais e
	 &man.ttys.5;, &man.gettytab.5;, &man.getty.8;, &amp; &man.init.8;
	 para informação sobre como configurar o sistema para aceitar 
	 logins de modems, e talvez &man.stty.1; para informações
	 sobre como ajustar os parâmetros da porta serial (como
	 <literal>clocal</literal> para interfaces seriais diretamente
	 conectadas).</para>
      </sect3>

      <sect3>
	<title>Rápida Introdução</title>

	<para>Na configuração típica, usar o FreeBSD como um servidor
	  SLIP funciona da seguinte forma: um usuário SLIP disca para
	  seu servidor SLIP e se autentica com um login especial SLIP 
	  que usa <filename>/usr/sbin/sliplogin</filename> como sua
	  shell.  O programa <command>sliplogin</command> navega pelo
	  arquivo <filename>/etc/sliphome/slip.hosts</filename> para
	  achar uma linha que contenha esse usuário, e se ele encontra,
	  conecta a linha serial com uma interface SLIP disponível
	  e então roda o script shell <filename>/etc/sliphome/slip.login</filename>
	  para configurar a interface SLIP.</para>

	<sect4>
	  <title>Exemplo de um Login</title>

	  <para>Por exemplo, se um usuário SLIP fosse <username>Shelmerg</username>, 
	    a entrada de <username>Shelmerg</username> no arquivo
	    <filename>/etc/master.passwd</filename> iria ser parecida
	    com isso:</para>

	  <programlisting>Shelmerg:password:1964:89::0:0:Guy Helmer - SLIP:/usr/users/Shelmerg:/usr/sbin/sliplogin</programlisting>

	<para>Quando <username>Shelmerg</username> entrasse,
	  <command>sliplogin</command> iria procurar por uma
	  linha em <filename>/etc/sliphome/slip.hosts</filename>
	  que contivesse o usuário; por exemplo, pode haver uma
	  linha no <filename>/etc/sliphome/slip.hosts</filename>
	  que fosse assim:</para>

	  <programlisting>Shelmerg	dc-slip sl-helmer       0xfffffc00		  autocomp</programlisting>

	<para><command>sliplogin</command> vai encontrar essa linha,
	  ligar a linha serial à próxima interface SLIP disponível e
	  então executar <filename>/etc/sliphome/slip.login</filename>
	  desta forma:</para>

	  <programlisting>/etc/sliphome/slip.login 0 19200 Shelmerg dc-slip sl-helmer 0xfffffc00 autocomp</programlisting>

	<para>Se tudo correr bem, <filename>/etc/sliphome/slip.login</filename>
	  irá executar o <command>ifconfig</command> para a interface SLIP
	  a qual <command>sliplogin</command> se ligou (interface 0,
	  no exemplo acima, que era o primeiro parâmetro na lista
	  dada a <filename>slip.login</filename>) para ajustar o 
	  endereço IP local (<hostid>dc-slip</hostid>), o endereço
	  IP remoto (<hostid>sl-helmer</hostid>), a máscara de rede
	   (<hostid role="netmask">0xfffffc00</hostid>), e qualquer
	   flag adicional (<literal>autocomp</literal>).  Se alguma
	   coisa acontecer de errado, <command>sliplogin</command>
	   geralmente grava uma mensagem em <filename>/var/log/messages</filename> 
	   (veja a página manual do &man.syslogd.8; e &man.syslog.conf.5; e
	   talvez verifique o <filename>/etc/syslog.conf</filename> para
	   ver o que o <command>syslogd</command> está gravando e onde
	   ele está gravando).</para>

	<para>OK, chega de exemplos &mdash; vamos ajustar o 
	  sistema.</para>
	</sect4>
      </sect3>

      <sect3>
	<title>Configuração do Kernel</title>
	<indexterm><primary>kernel</primary><secondary>configuration</secondary></indexterm>
	<para>O kernel padrão do FreeBSD vem com duas interfaces
	  SLIP definidas (<devicename>sl0</devicename> e 
	  <devicename>sl1</devicename>); você pode usar <command>netstat
	  -i</command> para ver se alguma dessas interfaces está
	  definida no seu kernel.</para>

	<para>Exemplo do <command>netstat -i</command>:</para>

	<screen>Name Mtu   Network     Address	    Ipkts Ierrs    Opkts Oerrs Coll
ed0   1500 &lt;Link&gt;0.0.c0.2c.5f.4a	 291311     0   174209     0   133
ed0   1500 138.247.224 ivory	     291311     0   174209     0   133
lo0   65535 &lt;Link&gt;			    79     0       79     0     0
lo0   65535 loop	localhost	     79     0       79     0     0
sl0*  296   &lt;Link&gt;			     0     0	0     0     0
sl1*  296   &lt;Link&gt;			     0     0	0     0     0</screen>

	<para>As interfaces <devicename>sl0</devicename> e
	  <devicename>sl1</devicename> mostradas pelo
	  <command>netstat -i</command> indicam que existem
	  duas interfaces SLIP no kernel. (O asterisco depois de
	  <literal>sl0</literal> e <literal>sl1</literal> indica
	  que as interfaces estão <quote>desligadas</quote>.)</para>

	<para>Entretanto, o kernel padrão do FreeBSD não vem configurado
	  para encaminhar pacotes (por padrão, uma máquina FreeBSD não 
	  funciona como roteador) devido aos requerimentos do RFC para
	  hosts da Internet (ver RFCs 1009 [Requeriments for Internet Gateways],
	  1222 [Requirements for Internet Hosts &mdash; Communication Layers],
	  e talvez 1127 [A Perspective on the Host Requirements]). Se você
	  quer que seu servidor SLIP haja como um roteador, edite o
	  arquivo <filename>/etc/rc.conf</filename> e troque o valor
	  da opção <literal>gateway_enable</literal> para <option>YES</option>.</para>

	<para>Você precisará reiniciar para que as novas definições 
	  entrem em ação.</para>

	<para>Você notará que perto do final da configuração do 
	  kernel padrão (<filename>/sys/i386/conf/GENERIC</filename>) 
	  haverá uma linha assim:</para>

	<programlisting>pseudo-device sl 2</programlisting>

	<indexterm><primary>SLIP</primary></indexterm>
	<para>Essa é a linha que define o número de dispositivos SLIP
	  disponíveis no kernel; o número no final da linha é o máximo
	  número de conexões SLIP que podem estar operando ao mesmo
	  tempo.</para>

	<para>Por favor veja <xref linkend="kernelconfig"> em Configurando
	  o kernel do FreeBSD para maiores informações sobre como
	  reconfigurar seu kernel.</para>
      </sect3>

      <sect3>
	<title>Configuração do Sliplogin</title>

	<para>Como mencionado anteriormente, existem três arquivos no
	  diretório <filename>/etc/sliphome</filename> que são parte
	  da configuração do <filename>/usr/sbin/sliplogin</filename>
	  (veja &man.sliplogin.8; para a página manual do <command>sliplogin</command>): 
	  <filename>slip.hosts</filename>, que define os usuários SLIP
	  associados aos endereços IP; <filename>slip.login</filename>,
	  que geralmente configura a interface SLIP; e (opcionalmente)
	  <filename>slip.logout</filename>, que desfaz o que o
	  <filename>slip.login</filename> fez quando a conexão serial
	  for terminada.</para>

	<sect4>
	  <title><filename>slip.hosts</filename> Configuration</title>

	  <para><filename>/etc/sliphome/slip.hosts</filename> contém
	    linhas que têm até quatro ítens separados por espaços:</para>

	  <itemizedlist>
	    <listitem>
	      <para>Login ID do usuários SLIP</para>
	    </listitem>

	    <listitem>
	      <para>Endereço local (local para o servidor SLIP) do link SLIP</para>
	    </listitem>

	    <listitem>
	      <para>Remote address of the SLIP link</para>
	    </listitem>

	    <listitem>
	      <para>Máscara de Rede</para>
	    </listitem>
	  </itemizedlist>

	  <para>Os endereços local e remoto podem ser nomes
	    (traduzidos para endereços IP pelo <filename>/etc/hosts</filename> 
	    ou por um serviço de nomes, dependendo das suas especificações
	    no <filename>/etc/nsswitch.conf</filename> no FreeBSD&nbsp;5.X
	    ou <filename>/etc/host.conf</filename> no FreeBSD&nbsp;4.X), e
	    a máscara de rede pode ser um nome que será traduzido pelo
	    <filename>/etc/networks</filename>.  Em um sistema de
	    exemplo o arquivo <filename>/etc/sliphome/slip.hosts</filename>
	    pode se parecer com isso:</para>

	  <programlisting>#
# login local-addr      remote-addr     mask	    opt1    opt2
#					       (normal,compress,noicmp)
#
Shelmerg dc-slip       sl-helmerg      0xfffffc00      autocomp</programlisting>

	  <para>No final da linha existe uma ou mais opções.</para>

	  <itemizedlist>
	    <listitem>
	      <para><option>normal</option> &mdash; sem compressão de cabeçalho</para>
	    </listitem>

	    <listitem>
	      <para><option>compress</option> &mdash; comprime os cabeçalhos</para>
	    </listitem>

	    <listitem>
	      <para><option>autocomp</option> &mdash; comprime os cabeçalhos se a 
	        ponta remota permitir isso</para>
	    </listitem>

	    <listitem>
	      <para><option>noicmp</option> &mdash; desabilita pacotes ICMP
	        (portanto qualquer pacote <quote>ping</quote> será descartado
		em vez de utilizar sua conexão)</para>
	    </listitem>
	  </itemizedlist>

  	  <indexterm><primary>SLIP</primary></indexterm>
  	  <indexterm><primary>TCP/IP networking</primary></indexterm>
	  <para>Sua escolha de endereços locais e remotos para os links
	    SLIP depende se você irá dedicar uma sub-rede ou se irá
	    utilizar <quote>proxy ARP</quote> no servidor SLIP (não é
	    proxy ARP <quote>verdadeiro</quote> mas essa é a terminologia
	    utilizada nessa seção para descrever isso). Se você não
	    tem certeza de qual método escolher ou como definir os 
	    endereços IP, por favor veja os livros sobre TCP/IP na
	    listagem de pré-requisitos (<xref linkend="slips-prereqs">)
	    e/ou consulte seu gerente de rede.</para>

	  <para>Se você vai utilizar uma rede separada para seus clientes
	    SLIP, você deverá alocar os endereços IP para seus clientes
	    dentre os disponíveis para essa rede escolhida. Então, você
	    provavelmente precisará configurar uma rota estática para
	    essa rede SLIP através do seu servidor SLIP no roteador
	    mais próximo.</para>

  	  <indexterm><primary>Ethernet</primary></indexterm>
	  <para>Caso você use <quote>proxy ARP</quote>, você precisará
	    definir os endereços IP dos seus clientes SLIP dentro os
	    disponíveis na rede Ethernet do seu servidor e também deverá
	    ajustar o <filename>/etc/sliphome/slip.login</filename> e
	    <filename>/etc/sliphome/slip.logout</filename> para usarem
	    &man.arp.8; para gerenciar as entradas proxy-ARP na tabela
	    ARP do servidor SLIP.</para>
	</sect4>

	<sect4>
	  <title>Configuração do <filename>slip.login</filename></title>

	  <para>Um <filename>/etc/sliphome/slip.login</filename> típico
	    se parece com o abaixo:</para>

	  <programlisting>#!/bin/sh -
#
#       @(#)slip.login 5.1 (Berkeley) 7/1/90

#
# arquivo de login genérico para uma linha slip. sliplogin invoca
# isso com os seguintes parâmetros:
#      1	2	 3	4	  5	 6     7-n
#   slipunit ttyspeed loginname local-addr remote-addr mask opt-args
#
/sbin/ifconfig sl$1 inet $4 $5 netmask $6</programlisting>

	  <para>Esse arquivo <filename>slip.login</filename> meramente
	    executa o comando <command>ifconfig</command> para a interface
	    SLIP apropriada com os endereços local e remoto e a máscara
	    de rede da interface.</para>

	  <para>Se você decidiu utilizar <quote>proxy ARP</quote>
	    (em vez de alocar uma sub-rede para seus clientes SLIP)
	    seu <filename>/etc/sliphome/slip.login</filename>
	    irá se parecer com o abaixo:</para>

	  <programlisting>#!/bin/sh -
#
#       @(#)slip.login 5.1 (Berkeley) 7/1/90

#
# arquivo de login genérico para uma linha slip. sliplogin invoca
# isso com os seguintes parâmetros:
#      1	2	 3	4	  5	 6     7-n
#   slipunit ttyspeed loginname local-addr remote-addr mask opt-args
#
/sbin/ifconfig sl$1 inet $4 $5 netmask $6
# Responde requisições ARP para o cliente SLIP com nosso endereço Ethernet
/usr/sbin/arp -s $5 00:11:22:33:44:55 pub</programlisting>

	  <para>Essa linha adicional, <command>arp -s &#36;5 00:11:22:33:44:55 pub</command>
	  cria uma entrada na tabela ARP do servidor. Essa entrada faz
	  com que o servidor responda com o endereço MAC do próprio 
	  servidor quando alguma outra máquina na rede Ethernet desejar
	  falar com endereço IP do cliente SLIP.</para>

  	  <indexterm><primary>Ethernet</primary><secondary>MAC address</secondary></indexterm>
	  <para>Quando estiver utilizando o exemplo acima tenha certeza
	    de trocar o endereço MAC (<hostid role="mac">00:11:22:33:44:55</hostid>)
	    pelo endereço da placa de rede Ethernet do seu sistema ou 
	    o <quote>proxy ARP</quote> definitivamente não funcionará! Você
	    pode descobrir o endereço MAC do seu servidor olhando a
	    saída do comando <command>netstat -i</command>; a segunda linha
	    deve se parecer com isso:</para>

	  <screen>ed0   1500 &lt;Link&gt;0.2.c1.28.5f.4a	 191923	0   129457     0   116</screen>

	  <para>Isso indica que o endereço da placa de rede, o MAC address,
	    é <hostid role="mac">00:02:c1:28:5f:4a</hostid> &mdash; 
	    os pontos no endereço fornecido por <command>netstat -i</command>
	    precisam ser trocados por dois pontos e devem ser adicionados
	    zeros em qualquer número hexadecimal que tenha um só digito
	    para converter para o formato que o &man.arp.8; deseja; veja
	    a página manual do &man.arp.8; para informações completas
	    de utilização.</para>

	  <note>
	    <para>Quando você cria o <filename>/etc/sliphome/slip.login</filename>
	      e <filename>/etc/sliphome/slip.logout</filename>, o bit <quote>execute</quote>
	      (<command>chmod 755 /etc/sliphome/slip.login /etc/sliphome/slip.logout</command>)
	      precisa estar definida, ou <command>sliplogin</command> não conseguirá
	      executá-los.</para>
	  </note>
	</sect4>

	<sect4>
	  <title>Configuração do <filename>slip.logout</filename></title>

	  <para>O <filename>/etc/sliphome/slip.logout</filename> não é
	    estritamente necessário (a não ser que você esteja implementando
	    <quote>proxy ARP</quote>), mas se você decidir criá-lo abaixo
	    temos um exemplo básico do script:</para>

	  <programlisting>#!/bin/sh -
#
#       slip.logout

#
# arquivo de login genérico para uma linha slip. sliplogin invoca
# isso com os seguintes parâmetros:
#      1	2	 3	4	  5	 6     7-n
#   slipunit ttyspeed loginname local-addr remote-addr mask opt-args
#
/sbin/ifconfig sl$1 down</programlisting>

	  <para>Se você estiver utilizando <quote>proxy ARP</quote> irá querer
	    que o <filename>/etc/sliphome/slip.logout</filename> remova a
	    entrada ARP do cliente SLIP:</para>

	  <programlisting>#!/bin/sh -
#
#       @(#)slip.logout

#
# arquivo de login genérico para uma linha slip. sliplogin invoca
# isso com os seguintes parâmetros:
#      1	2	 3	4	  5	 6     7-n
#   slipunit ttyspeed loginname local-addr remote-addr mask opt-args
#
/sbin/ifconfig sl$1 down
# Para de responder requisições ARP para o cliente SLIP
/usr/sbin/arp -d $5</programlisting>

	  <para>O comando <command>arp -d &#36;5</command> remove a entrada ARP
	    que o <filename>slip.login</filename> adicionou quando o cliente SLIP
	    se conectou.</para>

	  <para>É necessário repetir: tenha certeza de que o 
	    <filename>/etc/sliphome/slip.logout</filename> tem o bit de execução
	    definido depois que você criá-lo (por exemplo, <command>chmod 755 
	    /etc/sliphome/slip.logout</command>).</para>
	</sect4>
      </sect3>

      <sect3>
	<title>Considerações de Roteamento</title>
	<indexterm>
    <primary>SLIP</primary>
    <secondary>routing</secondary>
  </indexterm>
  	<para>Se você não está utilizando <quote>proxy ARP</quote> para
	rotear os pacotes entre seus clientes SLIP e o resto de sua
	rede (e talvez a Internet), você deve provavelmente ter
	rotas estáticas para seus roteadores para rotear a sub-rede
	dos seus clientes SLIP via seu servidor SLIP.</para>

	<sect4>
	  <title>Rotas Estáticas</title>
	  <indexterm><primary>static routes</primary></indexterm>

	  <para>Adicionar rotas estáticas para seus roteadores mais
	    próximos pode ser problemático (ou impossível se você
	    não tem autoridade para isso). Se você tem uma rede 
	    com diversos roteadores, alguns deles, como os
	    feitos pela Cisco e Proteon, podem não apenas precisar
	    ter as rotas configuradas mas também precisam saber
	    sobre quais rotas eles devem informar os outros roteadores,
	    portanto alguma experiência e certos ajustes podem
	    ser necessários para fazer com que sua rede baseada
	    em rotas estáticas funcione.</para>

	<sect4>
	  <title>Executando o <command>gated</command></title>
	  <indexterm>
      <primary><application>gated</application></primary>
    </indexterm>

	<note>
	  <para>O <command>gated</command> é um programa proprietário que
	    não tem seu código disponível para o público mais (mais
	    informações no site do <ulink url="http://www.gated.org/">gated</ulink>).
	    Essa seção só existe para manter compatibilidade para as
	    pessoas que ainda estão utilizando a versão antiga.</para>
	</note>

	  <para>Uma alternativa para as dores de cabeça com rotas estáticas
	    é instalar o <command>gated</command> no seu servidor SLIP
	    e configurar ele para usar os protocolos de roteamento 
	    apropriado (RIP/OSPF/BGP/EGP) para dizer aos outros roteadores
	    sobre sua rede SLIP. Você precisará editar um arquivo 
	    <filename>/etc/gated.conf</filename> para configurar seu
	    gated; aqui está um exemplo, similar ao que o autor utilizou
	    em um servidor SLIP FreeBSD:</para>

	  <programlisting>#
# gated configuration file for dc.dsu.edu; for gated version 3.5alpha5
# Only broadcast RIP information for xxx.xxx.yy out the ed Ethernet interface
#
#
# tracing options
#
traceoptions "/var/tmp/gated.output" replace size 100k files 2 general ;

rip yes {
  interface sl noripout noripin ;
  interface ed ripin ripout version 1 ;
  traceoptions route ;
} ;

#
# Turn on a bunch of tracing info for the interface to the kernel:
kernel {
  traceoptions remnants request routes info interface ;
} ;

#
# Propagate the route to xxx.xxx.yy out the Ethernet interface via RIP
#

export proto rip interface ed {
  proto direct {
      <replaceable>xxx.xxx.yy</replaceable> mask 255.255.252.0 metric 1; # SLIP connections
  } ;
} ;

#
# Accept routes from RIP via ed Ethernet interfaces
	
import proto rip interface ed {
  all ;
} ;</programlisting>

	  <indexterm><primary>RIP</primary></indexterm>
	  <para>O exemplo acima de um arquivo <filename>gated.conf</filename>
	    envia informação de roteamento sobre a sub-rede SLIP
	    <replaceable>xxx.xxx.yy</replaceable> via RIP por 
	    Ethernet; se você está utilizando um driver Ethernet
	    diferente do <devicename>ed</devicename> você precisará
	    trocar as referencias a <devicename>ed</devicename> pela
	    interface apropriada.  Esse exemplo também configura a
	    gravação de informações de <literal>debug</literal> sobre
	    a atividade do gated/ você pode certamente desligar isso 
	    se o <command>gated</command> funciona OK para você.  Você precisará
	    trocar o <replaceable>xxx.xxx.yy</replaceable> pelo
	    endereço da sua rede SLIP (tenha certeza de trocar
	    a máscara de rede na cláusula <literal>proto direct</literal>
	    também).</para>

	  <para>Uma vez que você instalou e configurou o <command>gated</command>
	    no seu sistema você precisará dizer aos script de inicialização
	    do FreeBSD para rodarem o <command>gated</command> no lugar
	    do <command>routed</command>.  A maneira mais fácil
	    é definir as variáveis <varname>router</varname> e
	    <varname>router_flags</varname> no <filename>/etc/rc.conf</filename>.
	    Por favor veja a página manual do <command>gated</command>
	    para mais informações.</para>
	</sect4>
      </sect3>
    </sect2>
  </sect1>
</chapter>

<!--
     Local Variables:
     mode: sgml
     sgml-declaration: "../chapter.decl"
     sgml-indent-data: t
     sgml-omittag: nil
     sgml-always-quote-attributes: t
     sgml-parent-document: ("../book.sgml" "part" "chapter")
     End:
-->
